---
layout: post
title: "Email Security: DMARC"
categories: Security
nav_order: 3
nav_exclude: false
---

{: .text-center }
# Email Security: DMARC (With SPF and DKIM)


### DMARC, DKIM, SPF: Email Authentication Methodology

{: .warning }
DMARC (Domain-based Message Authentication, Reporting & Conformance) is an email authentication protocol that builds upon the SPF and DKIM protocols.   It is primarily used for attempting to cut down on Email Spoofing attempts, Phishing and Scams. This primarily through Alignment checks, 

{: .warning }
***SPF*** (Sender Policy Framework): SPF is used in DMARC, it is an email authentication method that allows the owner of a domain to publish a record in which; mail servers are permitted to send emails on behalf of that domain.

Ex 1 | <span style="color: green; font-weight: bold;">myemailserv.com.</span>  <span style="color: yellow; font-weight: bold;">IN TXT</span>  <span style="color: red; font-weight: bold;">"v=spf1 include:_spf.google.com include:sendgrid.net ip4:192.0.2.0/24 -all"</span>

Ex 2 | myemailserv.com. IN TXT "v=spf1 ip4:172.10.200.4 ip6:2001:df7:0:2345:0:345:8:1 include:_spf.google.com include:mailgun.org include:amazonses.com -all"
Ex  3 | myemailserv.com. IN TXT "v=spf1 mx a include:_spf.mail.yahoo.com ~all"

- ***myemailserv.com*** specifies the <span style="color: green; font-weight: bold;">Domain</span>
- (<span style="color: yellow; font-weight: bold;">IN TXT</span>) illustrates that this information would be in a text file

The <span style="color: red; font-weight: bold;">Red</span> section, denotes the actual SPF rule: 

- ***v=spf1*** specifies the SPF <span style="color: red; font-weight: bold;">version</span> used.
- ***include:_spf.~.com*** indicates that an organization's servers and subdomains are <span style="color: red; font-weight: bold;">authorized</span> to send emails on behalf of rule since it authorizes and _includes_ that specific domain. (google -> gmail or amazon -> amazonses)
- ***-all*** specifies that any emails from mail servers not explicitly listed should be rejected and not recieved. (Fail)
- An ***~all*** tag would specify that any emails from a server or IP address, that is not listed in the SPF record *will* be accepted, although marked.

(also see [EasyDMARC] for more detail and other types of fail policies.)

{: .warning }
***DKIM*** (DomainKeys Identified Mail): DKIM lets the sender attach a digital signature to an email message, which can be verified by the recipient using the sender's public key published in the DNS. This ensures the message hasn't been altered and confirms its authenticity.





What are some roadblocks or barriers that email authentication faces currently? 
- Complex mail enviroments with 3rd party vendors, contractors, and service providers.
- The latter results in a mix of aggregated Un-authenticated and some Authenticated messages.
- The flow of internal vs external factors, the reciever's configuration vs the senders configuration. (Not enough shared information between senders and recievers.)

### DMarc Process + image

So how does DMARC work? 

DMARC was designed to slot into an organizations existing authentication proccesses.

To describe DMARC simply, the authentication method tests the alignment of a senders "Header" to what a Reciever has on record for that sender. 

Image dkim1

### DMARC record anatomy

### 5 basic steps for deploying DMARC

{: .highlight }


[EasyDMARC]: https://easydmarc.com/blog/spf-authentication-spf-all-vs-all/