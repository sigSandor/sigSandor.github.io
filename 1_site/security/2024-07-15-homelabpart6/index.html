<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(2) > li > a, .site-nav > ul:nth-of-type(2) > li > ul > li:not(:nth-child(5)) > a, .site-nav > ul:nth-of-type(2) > li > ul > li > ul > li > a { background-image: none; } .site-nav > ul:not(:nth-of-type(2)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(2) > li:nth-child(1) > ul > li:nth-child(5) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(2) > li:nth-child(1) > button svg, .site-nav > ul:nth-of-type(2) > li:nth-child(1) > ul > li:nth-child(5) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(2) > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul:nth-of-type(2) > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Part 6 - Active Directory Setup | Home</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Part 6 - Active Directory Setup" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Network &amp; Security Home Lab:" /> <meta property="og:description" content="Network &amp; Security Home Lab:" /> <link rel="canonical" href="https://sigsandor.github.io/security/2024-07-15-homelabpart6/" /> <meta property="og:url" content="https://sigsandor.github.io/security/2024-07-15-homelabpart6/" /> <meta property="og:site_name" content="Home" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-07-15T00:00:00-04:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Part 6 - Active Directory Setup" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-07-15T00:00:00-04:00","datePublished":"2024-07-15T00:00:00-04:00","description":"Network &amp; Security Home Lab:","headline":"Part 6 - Active Directory Setup","mainEntityOfPage":{"@type":"WebPage","@id":"https://sigsandor.github.io/security/2024-07-15-homelabpart6/"},"url":"https://sigsandor.github.io/security/2024-07-15-homelabpart6/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Home </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/CHANGELOG.html" class="nav-list-link">Changelog</a></li></ul> <div class="nav-category">Security</div> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Network & Security Home Lab category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/security/2024-05-15-homelabpart1/" class="nav-list-link">Network & Security Home Lab</a><ul class="nav-list"><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart2/" class="nav-list-link">Part 2 - pfSense Setup & Configuration</a></li><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart3/" class="nav-list-link">Part 3 - Parrot Security (Linux setup)</a></li><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart4/" class="nav-list-link">Part 4 - pfSense Firewall configuration</a></li><li class="nav-list-item"><a href="/security/2024-07-04-homelabpart5/" class="nav-list-link">Part 5 - Cyber Range setup</a></li><li class="nav-list-item"><a href="/security/2024-07-15-homelabpart6/" class="nav-list-link">Part 6 - Active Directory Setup</a></li></ul></li><li class="nav-list-item"><a href="/security/2024-5-26-DMARC/" class="nav-list-link">Email Authentication: DMARC</a></li><li class="nav-list-item"><a href="/security/2024-06-18-KQLbasics/" class="nav-list-link">KQL basics</a></li><li class="nav-list-item"><a href="/security/2022-05-19-links/" class="nav-list-link">Useful Cybersecurity links</a></li></ul> <div class="nav-category">Networking</div> <ul class="nav-list"><li class="nav-list-item"><a href="/networking/2024-06-22-NetworkingProtocols/" class="nav-list-link">Networking 101</a></li></ul> <div class="nav-category">Personal</div> <ul class="nav-list"><li class="nav-list-item"><a href="/personal/2020-05-21-dusunre/" class="nav-list-link">Online History</a></li><li class="nav-list-item"><a href="/personal/2024-05-16-explorepics/" class="nav-list-link">Photo collection</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Home" aria-label="Search Home" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://www.linkedin.com/in/alex-barkman-b7b26a186/" class="site-button" > Linkedin </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/sigSandor" class="site-button" > Github </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/security/2024-05-15-homelabpart1/">Network & Security Home Lab</a></li> <li class="breadcrumb-nav-list-item"><span>Part 6 - Active Directory Setup</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h2 id="network--security-home-lab"> <a href="#network--security-home-lab" class="anchor-heading" aria-labelledby="network--security-home-lab"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Network &amp; Security Home Lab: </h2> <p><img src="/assets/banner.jpg" alt="banner" width="auto" height="auto" /></p> <h6 id="in-progress-june-24-2024"> <a href="#in-progress-june-24-2024" class="anchor-heading" aria-labelledby="in-progress-june-24-2024"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> in progress <strong><em>June 24, 2024</em></strong> </h6> <h3 class="text-center" id="part-6---active-directory-setup"> <a href="#part-6---active-directory-setup" class="anchor-heading" aria-labelledby="part-6---active-directory-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: orange; font-weight: bold;">Part 6 - Active Directory Setup</span> </h3> <p>For the AD (Active Directory) Lab we are going to configure three VMs. We will first configure a Windows Server 2019 first for the DC (Domain Controller) for this machine. The other two VMs will be the clients that use this environment. They will be a Windows 10, and a Windows 11.</p> <p>Microsoft has provided Evaluation copies for each machine. There is a license period for each, however they should function just fine even after the evaluation period expires. (We can also create snapshots and export copies) The snapshots can be used to roll back to the start of the evaluation period, so it wont expire.</p> <p class="warning">I will create a video on how to make the AD lab expoitable, and create a Proof-of-Concepts for different attacks. For this guide we will <strong><em>only</em></strong> be setting up a basic AD configuration and getting a lay of the land.</p> <h2 id="downloading-windows-iso-files"> <a href="#downloading-windows-iso-files" class="anchor-heading" aria-labelledby="downloading-windows-iso-files"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Downloading Windows ISO Files</span> </h2> <h3 id="windows-server-2019"> <a href="#windows-server-2019" class="anchor-heading" aria-labelledby="windows-server-2019"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Windows Server 2019 </h3> <div class="table-wrapper"><table> <tbody> <tr> <td>Go to the following link: <strong><em><a href="https://www.microsoft.com/en-us/evalcenter/download-windows-server-2019">Windows Server 2019</a></em></strong></td> <td><em>Microsoft Evaluation Center</em></td> </tr> </tbody> </table></div> <p>Click on the <code class="language-plaintext highlighter-rouge">64-bit edition</code> download. The <code class="language-plaintext highlighter-rouge">.ISO</code> should be about 5.5GB.</p> <p><img src="/assets/vbox127.png" alt="vbox127" width="auto" height="auto" /></p> <h3 id="windows-11-enterprise"> <a href="#windows-11-enterprise" class="anchor-heading" aria-labelledby="windows-11-enterprise"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Windows 11 Enterprise </h3> <div class="table-wrapper"><table> <tbody> <tr> <td>Go to the following link: <strong><em><a href="https://www.microsoft.com/en-us/evalcenter/download-windows-11-enterprise">Windows 11 Enterprise</a></em></strong></td> <td><em>Microsoft Evaluation Center</em></td> </tr> </tbody> </table></div> <p>Click on the <code class="language-plaintext highlighter-rouge">64-bit edition</code> download. The <code class="language-plaintext highlighter-rouge">.ISO</code> should be about 6GB.</p> <p><img src="/assets/vbox128.png" alt="vbox128" width="auto" height="auto" /></p> <h3 id="windows-10-enterprise"> <a href="#windows-10-enterprise" class="anchor-heading" aria-labelledby="windows-10-enterprise"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Windows 10 Enterprise </h3> <div class="table-wrapper"><table> <tbody> <tr> <td>Go to the following link: <strong><em><a href="https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise">Windows 10 Enterprise</a></em></strong></td> <td><em>Microsoft Evaluation Center</em></td> </tr> </tbody> </table></div> <p>Click on the <code class="language-plaintext highlighter-rouge">64-bit edition</code> download. The <code class="language-plaintext highlighter-rouge">.ISO</code> should be about 4GB.</p> <p><img src="/assets/vbox129.png" alt="vbox129" width="auto" height="auto" /></p> <h3 id="iso-file-names"> <a href="#iso-file-names" class="anchor-heading" aria-labelledby="iso-file-names"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ISO File Names </h3> <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">ISO</span> <span class="nt">Name</span>	<span class="nt">OS</span> <span class="nt">Name</span>
<span class="nt">17763</span><span class="nc">.3650.221105-1748.rs5_release_svc_refresh_SERVER_EVAL_x64FRE_en-us</span>	<span class="err">`</span><span class="nt">Windows</span> <span class="nt">Server</span> <span class="nt">2019</span><span class="err">`</span>
<span class="nt">22631</span><span class="nc">.2428.231001-0608.23H2_NI_RELEASE_SVC_REFRESH_CLIENTENTERPRISEEVAL_OEMRET_x64FRE_en-us</span> <span class="err">`</span><span class="nt">Windows</span> <span class="nt">11</span> <span class="nt">Enterprise</span><span class="err">`</span>
<span class="nt">19045</span><span class="nc">.2006.220908-0225.22h2_release_svc_refresh_CLIENTENTERPRISEEVAL_OEMRET_x64FRE_en-us</span>	<span class="err">`</span><span class="nt">Windows</span> <span class="nt">10</span> <span class="nt">Enterprise</span><span class="err">`</span>

</code></pre></div></div> <p>The build number and file names may slightly differ.</p> <blockquote> <p>Make sure to rename the files with an identifiable name in order to mitigate user error.</p> </blockquote> <p><img src="/assets/vbox130.png" alt="vbox130" width="auto" height="auto" /></p> <h3 id="creating-the-vms"> <a href="#creating-the-vms" class="anchor-heading" aria-labelledby="creating-the-vms"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Creating the VMs</span> </h3> <h3 id="windows-server-2019-1"> <a href="#windows-server-2019-1" class="anchor-heading" aria-labelledby="windows-server-2019-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Windows Server 2019 </h3> <p>Click on Tools from the VirtualBox sidebar and select New.</p> <p><img src="/assets/vbox131.png" alt="vbox131" width="auto" height="auto" /></p> <p>Gave the VM a name. Ensure that the Folder option points to the location where all the Home Lab-related VMs are saved. For the ISO Image select the downloaded Windows Server 2019 image. Select the <code class="language-plaintext highlighter-rouge">Skip Unattended Installation</code> option and then click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Increase the Memory to <code class="language-plaintext highlighter-rouge">4096MB</code> and click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Increase the Hard Drive size to <code class="language-plaintext highlighter-rouge">100GB</code> and then click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Confirm that all the values look correct and then click on <code class="language-plaintext highlighter-rouge">Finish</code>.</p> <p><img src="/assets/vbox132.png" alt="vbox132" width="auto" height="auto" /></p><hr /> <p><img src="/assets/vbox133.png" alt="vbox133" width="auto" height="auto" /></p> <p class="new">The next VirtualBox installation of the Windows 11 VM, and Windows 10 VM will be very similar. I put dropdown refrence images to save space if they are needed.</p> <h2 id="windows-11-enterprise-vm"> <a href="#windows-11-enterprise-vm" class="anchor-heading" aria-labelledby="windows-11-enterprise-vm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Windows 11 Enterprise VM</span> </h2> <p>From the VirtualBox sidebar select Tools and then click on <code class="language-plaintext highlighter-rouge">New</code>.</p> <p>Give the VM a name. Ensure that the Folder option is pointing to the location where all the Home Lab VMs are saved. For the ISO Image option select the Windows 10 Enterprise image. Tick the <code class="language-plaintext highlighter-rouge">Skip Unattended Installation</code> option. Click on <code class="language-plaintext highlighter-rouge">Next</code> to continue.</p> <p>Leave Memory and CPU on its default value. Click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Increase the Hard Disk size to <code class="language-plaintext highlighter-rouge">80GB</code> and then click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Verify that all the options are correct and then click on <code class="language-plaintext highlighter-rouge">Finish</code>.</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox135.png" alt="vbox135" width="auto" height="auto" /> <img src="/assets/vbox136.png" alt="vbox136" width="auto" height="auto" /></p> </details> <h2 id="windows-10-enterprise-vm"> <a href="#windows-10-enterprise-vm" class="anchor-heading" aria-labelledby="windows-10-enterprise-vm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Windows 10 Enterprise VM</span> </h2> <p>Follow the same steps as above to create the VM for the second AD user.</p> <p class="warning">You can allocate more cores or resources if there is issues with Virtualization of the Windows Operating sytems.</p> <h3 id="adding-all-of-the-vms-to-a-group"> <a href="#adding-all-of-the-vms-to-a-group" class="anchor-heading" aria-labelledby="adding-all-of-the-vms-to-a-group"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Adding all of the VMs to a Group </h3> <p>Right-click on the Windows Server 2019 VM, Windows 11, and Windows 10 then choose <code class="language-plaintext highlighter-rouge">Move to Group</code> -&gt; [New].</p> <p>Right-click on the group name and select <code class="language-plaintext highlighter-rouge">Rename Group</code>. Name the group <code class="language-plaintext highlighter-rouge">Active Directory</code>.</p> <p>Right-click on the group name (Active Directory) and choose <code class="language-plaintext highlighter-rouge">Move to Group</code> -&gt; <code class="language-plaintext highlighter-rouge">Home Lab</code>.</p> <p>The final output should look as follows:</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox134.png" alt="vbox134.png" width="auto" height="auto" /></p> </details> <h2 id="configuring-the-vms"> <a href="#configuring-the-vms" class="anchor-heading" aria-labelledby="configuring-the-vms"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Configuring the VMs</span> </h2> <p class="new">Again, the next VirtualBox configuration steps of the Windows Server 2019, Windows 11 VM, and Windows 10 VM will be very similar. I put dropdown refrence images to save space if they are needed.</p> <h3 id="windows-server-2019-"> <a href="#windows-server-2019-" class="anchor-heading" aria-labelledby="windows-server-2019-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Windows Server 2019 </span> </h3> <p>Select the Windows Server 2019 VM and click on <code class="language-plaintext highlighter-rouge">Settings</code> from the toolbar.</p> <p>Go to <code class="language-plaintext highlighter-rouge">System</code> -&gt; <code class="language-plaintext highlighter-rouge">Motherboard</code>. For Boot Order ensure Hard Disk is not the top followed by <code class="language-plaintext highlighter-rouge">Optical</code>. Disable <code class="language-plaintext highlighter-rouge">Floppy</code>.</p> <p>Go to <code class="language-plaintext highlighter-rouge">Network</code> -&gt; <code class="language-plaintext highlighter-rouge">Adapter 1</code>. For the Attacked to field select Internal Network. For name select <code class="language-plaintext highlighter-rouge">LAN 2</code>. Click on <code class="language-plaintext highlighter-rouge">OK</code> to save the settings.</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox137.png" alt="vbox137.png" width="auto" height="auto" /> <img src="/assets/vbox138.png" alt="vbox138.png" width="auto" height="auto" /> <img src="/assets/vbox139.png" alt="vbox139.png" width="auto" height="auto" /></p> </details> <h3 id="windows-11-enterprise-"> <a href="#windows-11-enterprise-" class="anchor-heading" aria-labelledby="windows-11-enterprise-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Windows 11 Enterprise </span> </h3> <p>Select Windows 11 Enterprise from the sidebar and then from the toolbar choose Settings.</p> <p>Go to <code class="language-plaintext highlighter-rouge">System</code> -&gt; <code class="language-plaintext highlighter-rouge">Motherboard</code>. For Boot Order ensure Hard Disk is on the top followed by <code class="language-plaintext highlighter-rouge">Optical</code>. Disable <code class="language-plaintext highlighter-rouge">Floppy</code>.</p> <p>Go to <code class="language-plaintext highlighter-rouge">Network</code> -&gt; <code class="language-plaintext highlighter-rouge">Adapter 1</code>. For the Attacked to field select <code class="language-plaintext highlighter-rouge">Internal Network</code>. For name select <code class="language-plaintext highlighter-rouge">LAN 2</code>. Click on <code class="language-plaintext highlighter-rouge">OK</code> to save the settings.</p> <h3 id="windows-10-enterprise-"> <a href="#windows-10-enterprise-" class="anchor-heading" aria-labelledby="windows-10-enterprise-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Windows 10 Enterprise </span> </h3> <p>Select Windows 10 Enterprise from the sidebar and then from the toolbar choose <code class="language-plaintext highlighter-rouge">Settings</code>.</p> <p>Go to <code class="language-plaintext highlighter-rouge">System</code> -&gt; <code class="language-plaintext highlighter-rouge">Motherboard</code>. For Boot Order ensure <code class="language-plaintext highlighter-rouge">Hard Disk</code> is on the top followed by <code class="language-plaintext highlighter-rouge">Optical</code>. Disable <code class="language-plaintext highlighter-rouge">Floppy</code>.</p> <p>Go to <code class="language-plaintext highlighter-rouge">Network</code> -&gt; <code class="language-plaintext highlighter-rouge">Adapter 1</code>. For the Attacked to field select Internal Network. For name select <code class="language-plaintext highlighter-rouge">LAN 2</code>. Click on <code class="language-plaintext highlighter-rouge">OK</code> to save the settings.</p><hr /> <h2 id="windows-server-2019-setup"> <a href="#windows-server-2019-setup" class="anchor-heading" aria-labelledby="windows-server-2019-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Windows Server 2019 Setup</span> </h2> <h3 id="os-installation"> <a href="#os-installation" class="anchor-heading" aria-labelledby="os-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> OS Installation </h3> <p>Select Windows Server 2019 from the sidebar and click on <code class="language-plaintext highlighter-rouge">Start</code> from the toolbar.</p> <p>Click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Click on Install now.</p> <p>Select <code class="language-plaintext highlighter-rouge">Windows Server 2019 Standalone Evaluation (Desktop Experience)</code> and click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Accept the agreement and click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Select <code class="language-plaintext highlighter-rouge">Custom: Install Windows only (Advanced)</code>.</p> <p>Select <code class="language-plaintext highlighter-rouge">Disk 0</code> and click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>The VM will restart a couple of times during the installation process.</p> <p class="new">For the Installation of the Windows Server, refer to the below pictures.</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox140.png" alt="vbox140.png" width="auto" height="auto" /> <img src="/assets/vbox141.png" alt="vbox141.png" width="auto" height="auto" /> <img src="/assets/vbox142.png" alt="vbox142.png" width="auto" height="auto" /> <img src="/assets/vbox143.png" alt="vbox143.png" width="auto" height="auto" /> <img src="/assets/vbox144.png" alt="vbox144.png" width="auto" height="auto" /> <img src="/assets/vbox145.png" alt="vbox145.png" width="auto" height="auto" /> <img src="/assets/vbox146.png" alt="vbox146.png" width="auto" height="auto" /> <img src="/assets/vbox147.png" alt="vbox147.png" width="auto" height="auto" /></p> </details> <h2 id="os-setup--configuration--1037"> <a href="#os-setup--configuration--1037" class="anchor-heading" aria-labelledby="os-setup--configuration--1037"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">OS Setup &amp; Configuration</span> 10:37 </h2> <p>Once the installation is complete,</p> <blockquote> <p>Enter a password for the Administrator account. Once set and remembered click on <code class="language-plaintext highlighter-rouge">Finish</code>.</p> </blockquote> <p><img src="/assets/vbox148.png" alt="vbox148.png" width="auto" height="auto" /></p> <p>Once at the login Screen we can use the <code class="language-plaintext highlighter-rouge">Ctrl+Alt+Delete</code> shortcut.</p> <p><img src="/assets/vbox149.png" alt="vbox149.png" width="auto" height="auto" /></p> <p>Once we log in. Server Manager will automatically open. A popup will also open asking us to try Windows Admin Center. Click on Don’t show this message again and then click on X to close the popup.</p> <p><img src="/assets/vbox150.png" alt="vbox150.png" width="auto" height="auto" /></p> <h3 id="guest-additions-installation"> <a href="#guest-additions-installation" class="anchor-heading" aria-labelledby="guest-additions-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Guest Additions Installation </h3> <p>To make the Virtual machine autosize the window we need to install Guest Additions. From the VM toolbar click on <code class="language-plaintext highlighter-rouge">Devices</code> -&gt; <code class="language-plaintext highlighter-rouge">Optical Devices</code> -&gt; <code class="language-plaintext highlighter-rouge">Remove disk</code> from virtual drive. This will remove the <code class="language-plaintext highlighter-rouge">Windows Server 2019 image</code> from the disk drive.</p> <p><img src="/assets/vbox151.png" alt="vbox151.png" width="auto" height="auto" /></p> <p>Then select <code class="language-plaintext highlighter-rouge">Devices</code>-&gt; <code class="language-plaintext highlighter-rouge">Insert Guest Additions CD image</code>.</p> <p><img src="/assets/vbox152.png" alt="vbox152.png" width="auto" height="auto" /></p> <p>From the taskbar open File Explorer. Once the disk is loaded it will show up in the sidebar. Click on it to view its content. Double-click on VBoxWindowsAdditions (4th file from bottom) to start the installer.</p> <p>Click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> <p>Click on <code class="language-plaintext highlighter-rouge">Next</code> again to install the requirement components.</p> <p>Choose <code class="language-plaintext highlighter-rouge">Reboot now</code> and click on <code class="language-plaintext highlighter-rouge">Finish</code>. The VM will restart automatically.</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox154.png" alt="vbox154.png" width="auto" height="auto" /> <img src="/assets/vbox155.png" alt="vbox155.png" width="auto" height="auto" /> <img src="/assets/vbox156.png" alt="vbox156.png" width="auto" height="auto" /></p> </details> <blockquote> <p>After restarting, log in.</p> </blockquote> <blockquote> <p>From the VM toolbar click on <code class="language-plaintext highlighter-rouge">Devices</code> -&gt; <code class="language-plaintext highlighter-rouge">Optical Drivers</code> -&gt; <code class="language-plaintext highlighter-rouge">Remove disk</code> from virtual drive to remove the Guest Additions image.</p> </blockquote> <p><img src="/assets/vbox157.png" alt="vbox157.png" width="auto" height="auto" /></p> <p>Now we have more functionality for resizing the screen.</p> <blockquote> <p>Use the shortcut <code class="language-plaintext highlighter-rouge">Right Ctrl+F</code> to enter and exit Fullscreen mode.</p> </blockquote> <h2 id="network-configuration"> <a href="#network-configuration" class="anchor-heading" aria-labelledby="network-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Network Configuration</span> </h2> <p>During the pfSense setup module (Part 2) we disabled <code class="language-plaintext highlighter-rouge">DHCP</code> on the <code class="language-plaintext highlighter-rouge">AD_LAB</code> interface and now out Windows Server will <em>not</em> automatically be assigned an IP address. We intentionally set it up this way because we want to create a Domain Controller with other machines attached.</p> <p>From the taskbar right-click on the network icon and select Open <code class="language-plaintext highlighter-rouge">Network &amp; Internet settings</code>.</p> <p><img src="/assets/vbox158.png" alt="vbox158.png" width="auto" height="auto" /></p> <p>Click on “Change adapter options”.</p> <p>On the Network Connections page, we should see the <code class="language-plaintext highlighter-rouge">Ethernet adapter</code>. Right-click on the adapter and select <code class="language-plaintext highlighter-rouge">Properties</code>.</p> <p>Select <code class="language-plaintext highlighter-rouge">Internet Protocol Version 4 (TCP/IPv4)</code> and click on <code class="language-plaintext highlighter-rouge">Properties</code>.</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox159.png" alt="vbox159.png" width="auto" height="auto" /> <img src="/assets/vbox160.png" alt="vbox160.png" width="auto" height="auto" /> <img src="/assets/vbox161.png" alt="vbox161.png" width="auto" height="auto" /></p> </details> <blockquote> <p>Once in the IPV4 Properties</p> </blockquote> <p>Enter the details as shown below and then click on <code class="language-plaintext highlighter-rouge">OK</code>. Click on <code class="language-plaintext highlighter-rouge">OK</code> again to close the Ethernet Properties menu.</p> <p>IP address: <code class="language-plaintext highlighter-rouge">10.80.80.2</code> Subnet mask: <code class="language-plaintext highlighter-rouge">255.255.255.0</code> Default gateway: <code class="language-plaintext highlighter-rouge">10.80.80.1</code> Preferred DNS Server: <code class="language-plaintext highlighter-rouge">10.80.80.2</code></p> <blockquote> <p>Double check below</p> </blockquote> <p><img src="/assets/vbox162.png" alt="vbox162.png" width="auto" height="auto" /></p> <blockquote> <p>Next, Windows will display a notification to allow internet access click on Yes.</p> </blockquote> <p><img src="/assets/vbox163.png" alt="vbox163.png" width="auto" height="auto" /></p> <p>21:22</p> <p>Close the Network Connections page.</p> <p>In the Settings app click on the Home button (above search bar).</p> <p>Renaming the System</p> <p>Before we can set up the machine to be a Domain Controller let us rename the PC. Select “System”.</p> <p>Click on About on the sidebar and then click on the “Rename this PC” button. Give the PC an easy-to-remember name and then click on Next.</p> <p>Click on “Restart now” for the changes to take effect.</p> <h2 id="active-directory--dns-installation"> <a href="#active-directory--dns-installation" class="anchor-heading" aria-labelledby="active-directory--dns-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Active Directory &amp; DNS Installation</span> </h2> <p>After login wait for Server Manager to load. Click on the Manage button from the top right corner and select “Add Roles and Features”.</p> <p>Click on Next till you reach the Server Roles page.</p> <p>On this page enable “Active Directory Domain Services” and “DNS Server”.</p> <p>When you enable a feature the “Add Roles and Features Wizard” will open click on “Add Features” to confirm the selection.</p> <p>Once both the features are selected click on Next to proceed with installation.</p> <p>Click Next till you reach the Confirmation page. Here click on Install to start the installation of the selected features.</p> <p>Once the installation is complete click on Close to exit the Wizard.\</p> <h2 id="active-directory-configuration"> <a href="#active-directory-configuration" class="anchor-heading" aria-labelledby="active-directory-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Active Directory Configuration</span> </h2> <p>Click on the Flag icon present in the top right of the toolbar in Server Manager. From the dropdown click on “Promote this server to a domain controller”.</p> <p>The AD Domain Servers Configuration Wizard will open. For deployment operation select Add a new Forest. Give the domain a name. For my setup, I will be using the domain name ad.lab. After selecting the name click on Next.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The name assigned to the domain has to be made of two words that are separated by a period.
</code></pre></div></div> <p>On this page enter a password to use for using the AD Restore feature.</p> <p>Ignore the warning that is shown and click on Next.</p> <p>The NetBIOS name should automatically be filled. It will be the first part of the domain name. Click on Next to continue.</p> <p>Click on Next.</p> <p>Click on Next.</p> <p>Click on Install to start the Domain Services setup process.</p> <p>Once the install process is complete the machine will need to restart. Click on Close to reboot the system.</p> <p>On restart, you will notice that the name that is shown on the login page has changed. The first part of the domain name is prepended to the username. This means the machine has successfully been configured as the domain controller. Log in using the Administrator password.</p> <h3 id="dns-configuration"> <a href="#dns-configuration" class="anchor-heading" aria-labelledby="dns-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">DNS Configuration</span> </h3> <p>Since we enabled DNS on this machine (Domain Controller). This machine (DC) will act as the DNS server for devices that are connected to the ad.lab environment. For the DNS service to function properly we need to configure a Forwarder. Forwarder is the device to which the DNS queries will be sent when the DC cannot resolve it. In our case, we need to forward the request to pfSense. The DNS service of pfSense will then perform the lookup.</p> <p>Open the Start menu expand the “Windows Administrative Tools” folder and select DNS.</p> <p>In the sidebar select the Domain Controller (in my case DC1) and from the right menu double-click on “Forwarders”.</p> <p>Go to Forwarders -&gt; Edit.</p> <p>This will open the Forwarder configuration page. Enter the IP address of the AD_LAB interface (10.80.80.1) and press Enter.</p> <p>Once added. Click on OK to confirm the change.</p> <p>Click on Apply then OK to save the changes.</p> <h3 id="dhcp-installation"> <a href="#dhcp-installation" class="anchor-heading" aria-labelledby="dhcp-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">DHCP Installation</span> </h3> <p>Since DHCP is disabled on the AD_LAB interface when new devices are added they will not be assigned an IP address. We will enable the DHCP service on the DC. Once set devices that connect to the AD_LAB network will be automatically assigned an IP address by the Domain Controller DHCP server.</p> <p>Click on Manage from the toolbar in Server Manager. Then choose “Add Roles and Features”.</p> <p>Keep clicking Next till you reach the “Server Roles” page. Enable “DHCP Server” then click on “Add Features”.</p> <p>Keep clicking Next till you reach the Confirmation page. Click Install to enable DHCP.</p> <h3 id="dhcp-configuration"> <a href="#dhcp-configuration" class="anchor-heading" aria-labelledby="dhcp-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">DHCP Configuration</span> </h3> <p>After the installation is complete click on the Flag present in the toolbar of Server Manager and click on “Complete DHCP configuration”.</p> <p>Click on Commit.</p> <p>Click on Close to complete the installation.</p> <p>From the Start menu click on “Windows Administrative Tools” and then choose DHCP.</p> <p>Expand the DHCP server (in my case dc1.ad.lab) dropdown on the left side of the window.</p> <p>Right-click on IPv4. Then select “New Scope”. The scope defines the range of IP addresses that can be assigned to devices by the DHCP server.</p> <p>Enter a Name and Description for the new scope.</p> <p>Enter the details as shown below.</p> <p>Start IP address: 10.80.80.11 End IP address: 10.80.80.253 Length: 24 Subnet mask: 255.255.255.0</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>You can chose the Start IP address to be 10.80.80.3. I have purposely left the starting IP addresses out of the DHCP scope. In the future if the need arises I can use these IPs for static IP assignment.
</code></pre></div></div> <p>We don’t have any Exclusions (static IP assignment). Leave all the options empty and click on Next.</p> <p>Increase the lease time to 365 days and click on Next.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Since we increased the lease duration when a IP address is assigned to a device the device will be allowed to use that IP address without requesting a new IP address for 365 days.
</code></pre></div></div> <p>Select “Yes, I want to configure these options now” and click on Next.</p> <p>In the IP address field enter the default gateway for the AD_LAB interface (10.80.80.1) and then click on Add. Once added click on Next.</p> <p>Click on Next.</p> <p>We are not configuring a WINS Server for our environment so click on Next.</p> <p>Select “Yes, I want to activate this scope now” and click on Next.</p> <p>So far we have installed Windows Server 2019, installed Guest Additions, configured the VM to be the Domain Controller (DC), set up a DNS Forwarder and configured DHCP. We still need to create users in the DC and set up client machines to use the AD environment. We will cover these topics in part 2 of this module.</p> <p><span style="color: royalblue; font-weight: bold;">Part 7 - Active Directory Lab Setup - Part 2</span></p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
