<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(2) > li > a, .site-nav > ul:nth-of-type(2) > li > ul > li:not(:nth-child(1)) > a, .site-nav > ul:nth-of-type(2) > li > ul > li > ul > li > a { background-image: none; } .site-nav > ul:not(:nth-of-type(2)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(2) > li:nth-child(1) > ul > li:nth-child(1) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(2) > li:nth-child(1) > button svg, .site-nav > ul:nth-of-type(2) > li:nth-child(1) > ul > li:nth-child(1) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(2) > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul:nth-of-type(2) > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Part 2 - pfSense Setup &amp; Configuration | Home</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Part 2 - pfSense Setup &amp; Configuration" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Network &amp; Security Home Lab:" /> <meta property="og:description" content="Network &amp; Security Home Lab:" /> <link rel="canonical" href="https://sigsandor.github.io/security/2024-05-16-homelabpart2/" /> <meta property="og:url" content="https://sigsandor.github.io/security/2024-05-16-homelabpart2/" /> <meta property="og:site_name" content="Home" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-05-16T00:00:00-04:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Part 2 - pfSense Setup &amp; Configuration" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-05-16T00:00:00-04:00","datePublished":"2024-05-16T00:00:00-04:00","description":"Network &amp; Security Home Lab:","headline":"Part 2 - pfSense Setup &amp; Configuration","mainEntityOfPage":{"@type":"WebPage","@id":"https://sigsandor.github.io/security/2024-05-16-homelabpart2/"},"url":"https://sigsandor.github.io/security/2024-05-16-homelabpart2/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Home </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/CHANGELOG.html" class="nav-list-link">Changelog</a></li></ul> <div class="nav-category">Security</div> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Network & Security Home Lab category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/security/2024-05-15-homelabpart1/" class="nav-list-link">Network & Security Home Lab</a><ul class="nav-list"><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart2/" class="nav-list-link">Part 2 - pfSense Setup & Configuration</a></li><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart3/" class="nav-list-link">Part 3 - Parrot Security (Linux setup)</a></li><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart4/" class="nav-list-link">Part 4 - pfSense Firewall configuration</a></li><li class="nav-list-item"><a href="/security/2024-07-04-homelabpart5/" class="nav-list-link">Part 5 - Cyber Range setup</a></li><li class="nav-list-item"><a href="/security/2024-07-15-homelabpart6/" class="nav-list-link">Part 6 - Active Directory Setup</a></li></ul></li><li class="nav-list-item"><a href="/security/2024-5-26-DMARC/" class="nav-list-link">Email Authentication: DMARC</a></li><li class="nav-list-item"><a href="/security/2024-06-18-KQLbasics/" class="nav-list-link">KQL basics</a></li><li class="nav-list-item"><a href="/security/2022-05-19-links/" class="nav-list-link">Useful Cybersecurity links</a></li></ul> <div class="nav-category">Networking</div> <ul class="nav-list"><li class="nav-list-item"><a href="/networking/2024-06-22-NetworkingProtocols/" class="nav-list-link">Networking 101</a></li></ul> <div class="nav-category">Personal</div> <ul class="nav-list"><li class="nav-list-item"><a href="/personal/2020-05-21-dusunre/" class="nav-list-link">Online History</a></li><li class="nav-list-item"><a href="/personal/2024-05-16-explorepics/" class="nav-list-link">Photo collection</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Home" aria-label="Search Home" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://www.linkedin.com/in/alex-barkman-b7b26a186/" class="site-button" > Linkedin </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/sigSandor" class="site-button" > Github </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/security/2024-05-15-homelabpart1/">Network & Security Home Lab</a></li> <li class="breadcrumb-nav-list-item"><span>Part 2 - pfSense Setup & Configuration</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 class="text-center" id="network--security-home-lab"> <a href="#network--security-home-lab" class="anchor-heading" aria-labelledby="network--security-home-lab"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Network &amp; Security Home Lab: </h1> <p><img src="/assets/banner.jpg" alt="banner" width="auto" height="auto" /></p> <h6 id="posted-may-22-2024"> <a href="#posted-may-22-2024" class="anchor-heading" aria-labelledby="posted-may-22-2024"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Posted <strong><em>May 22, 2024</em></strong> </h6> <h2 class="text-center" id="part-2---pfsense-initial-setup--configuration"> <a href="#part-2---pfsense-initial-setup--configuration" class="anchor-heading" aria-labelledby="part-2---pfsense-initial-setup--configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: orange; font-weight: bold;">Part 2 - pfSense initial Setup &amp; Configuration</span> </h2> <p>In this portion, we will go over the basic installation of <code class="language-plaintext highlighter-rouge">pfSense</code> router as a vm. Later on, we will also complete the system configuration, network interfaces, and then configure the router for the lab.</p><hr /> <p class="warning">pfSense is going to be the default gateway for our home lab as well. This means that pfSense will have to be the first VM that is booted. Any VM’s launched before pfSense will have network connectivity issues.</p> <h2 id="downloading-pfsense"> <a href="#downloading-pfsense" class="anchor-heading" aria-labelledby="downloading-pfsense"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Downloading pfSense</span> </h2> <blockquote> <p>For the download,</p> </blockquote> <p>Go to: <code class="language-plaintext highlighter-rouge">pfSense Community Edition</code> &gt; <a href="https://www.pfsense.org/download/">Download</a></p> <p>As of May 22, 2024 the latest version of pfSense is <code class="language-plaintext highlighter-rouge">2.7.2</code>.</p> <p><code class="language-plaintext highlighter-rouge">You will have to create an account with NetGate, which I wont be covering. Account setup is free, and once registered navigate to the download portal.</code></p> <p><img src="/assets/vbox18.png" alt="vbox18.png" width="auto" height="auto" /></p> <h3 id="select-the-following"> <a href="#select-the-following" class="anchor-heading" aria-labelledby="select-the-following"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Select the following:</span> </h3> <blockquote> <p>Architecture: <code class="language-plaintext highlighter-rouge">AMD64 (64-bit)</code></p> </blockquote> <blockquote> <p>Installer: <code class="language-plaintext highlighter-rouge">DVD Image (ISO) Installer</code></p> </blockquote> <blockquote> <p>Mirror: <code class="language-plaintext highlighter-rouge">Location closest to you</code></p> </blockquote> <p>The downloaded file will have an <code class="language-plaintext highlighter-rouge">.iso.gz</code> file type.</p> <p>You can use <em>7-Zip</em> or another decompression software to extract the image.</p> <p>After extraction, we should have a <code class="language-plaintext highlighter-rouge">.iso</code> file.</p><hr /> <p>Optionally, you can create a specific folder for the downloaded and extracted files to live in.</p> <p>Here, I created a folder in <code class="language-plaintext highlighter-rouge">Documents&gt;Virtual Machine Folder</code> that I will be using for the duration of the guide.</p> <p><img src="/assets/vbox19.png" alt="vbox19.png" width="auto" height="auto" /></p><hr /> <h2 id="pfsense-vm-creation"> <a href="#pfsense-vm-creation" class="anchor-heading" aria-labelledby="pfsense-vm-creation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">pfSense VM Creation</span> </h2> <p>Launch VirtualBox. Click on <code class="language-plaintext highlighter-rouge">Tools</code> from the sidebar and then <strong><em>New</em></strong>.</p> <ul> <li> <p>For name selection, “PfSense Firewall/Router” works.</p> </li> <li> <p>From the ISO Image dropdown select <em>Others</em> in order to select the <code class="language-plaintext highlighter-rouge">.iso</code> file that we just extracted.</p> </li> <li> <p>Select Type as <code class="language-plaintext highlighter-rouge">BSD</code>, and Version as <code class="language-plaintext highlighter-rouge">FreeBSD (64-bit)</code> then click on <code class="language-plaintext highlighter-rouge">Next</code>.</p> </li> </ul> <p><img src="/assets/vbox3new.png" alt="vbox3new" width="auto" height="auto" /></p> <ul> <li> <p>On the next page, we can select the amount of RAM and CPU that the VM will use. As a baseline, You can choose 1024-2048 Base memory and 1-2 CPU cores.</p> </li> <li> <p>Click on <code class="language-plaintext highlighter-rouge">Next</code> to continue.</p> <blockquote> <p>(No need for extraneous Memory or Enabling EFI in this case)</p> </blockquote> </li> </ul> <p><img src="/assets/vbox4new.png" alt="vbox4new" width="auto" height="auto" /></p> <ul> <li>On the next page, we can choose the amount of storage space to reserve for the VM. (20GB will suffice.)</li> </ul> <p><img src="/assets/vbox5new.png" alt="vbox5new" width="auto" height="auto" /></p><hr /> <h2 id="final-confirmation"> <a href="#final-confirmation" class="anchor-heading" aria-labelledby="final-confirmation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Final Confirmation</span> </h2> <p><img src="/assets/vbox6new.png" alt="vbox6new" width="auto" height="auto" /></p> <ul> <li> <p>Confirm that everything looks right and then click on <code class="language-plaintext highlighter-rouge">Finish</code>.</p> </li> <li> <p>Once done, we should see the newly created VM in the sidebar.</p> </li> </ul><hr /> <h2 id="grouping-our-first-vm"> <a href="#grouping-our-first-vm" class="anchor-heading" aria-labelledby="grouping-our-first-vm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Grouping our First VM</span> </h2> <p>I want to keep the VMs organized by using the Groups feature of VirtualBox. I would strongly suggest implementing such organization since we are dealing with a large number of virtual machines.</p> <h3 id="to-create-a-group"> <a href="#to-create-a-group" class="anchor-heading" aria-labelledby="to-create-a-group"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> To Create a group </h3> <ul> <li>Right-click on the pfSense VM from the sidebar, <code class="language-plaintext highlighter-rouge">select Move to Group -&gt; *New*</code>. The VM will now be added to a Group called New Group.</li> </ul> <p>Right-click on the Group, and select <code class="language-plaintext highlighter-rouge">Rename Group</code>. Name the Group <strong><em>Firewall</em></strong>.</p> <p>The final result should match the following:</p> <p><img src="/assets/vbox7new.png" alt="vbox7new" width="auto" height="auto" /></p><hr /> <h2 id="pfsense-basic-virtual-configuration"> <a href="#pfsense-basic-virtual-configuration" class="anchor-heading" aria-labelledby="pfsense-basic-virtual-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">pfSense Basic Virtual Configuration</span> </h2> <p>Before we boot the VM we need to configure some settings related to VirtualBox. Select the pfSense VM from the sidebar and then click on <code class="language-plaintext highlighter-rouge">Settings</code>.</p> <p><img src="/assets/vbox20.png" alt="vbox20.png" width="auto" height="auto" /></p> <h2 id="system-configuration"> <a href="#system-configuration" class="anchor-heading" aria-labelledby="system-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">System Configuration</span> </h2> <p>Select <code class="language-plaintext highlighter-rouge">System -&gt; Motherboard</code> in the Boot Order section use the arrows to move <code class="language-plaintext highlighter-rouge">the Hard Disk</code> to the top, <code class="language-plaintext highlighter-rouge">Optical</code> should be next. Ensure that <code class="language-plaintext highlighter-rouge">Floppy</code> is unchecked.</p> <p><img src="/assets/vbox21.png" alt="vbox21.png" width="auto" height="auto" /></p> <p class="warning">You may have to drag the top of the window <em>upwards</em> in order to hit the next button.</p> <h3 id="audio--usb-configuration"> <a href="#audio--usb-configuration" class="anchor-heading" aria-labelledby="audio--usb-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Audio &amp; USB Configuration</span> </h3> <ul> <li> <p>Go to the Audio tab and disable Audio option. Since the VM we are configuring is a router we will not be using audio. (optional)</p> </li> <li> <p>Go to the USB tab and uncheck the Enable USB Controller option. Since this VM we are configuring is a router we will not need USB support. (optional)</p> </li> </ul> <h2 id="network-configuration"> <a href="#network-configuration" class="anchor-heading" aria-labelledby="network-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Network Configuration</span> </h2> <p>Go to <code class="language-plaintext highlighter-rouge">Network -&gt; Adapter 1</code>. For the Attached to field select <code class="language-plaintext highlighter-rouge">NAT</code>. Expand the <code class="language-plaintext highlighter-rouge">Advanced</code> section and for Adaptor Type select <code class="language-plaintext highlighter-rouge">Paravirtualized Network (virtio-net)</code>.</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox22.png" alt="vbox22.png" width="auto" height="auto" /> <img src="/assets/vbox23.png" alt="vbox23.png" width="auto" height="auto" /> <img src="/assets/vbox24.png" alt="vbox24.png" width="auto" height="auto" /> <img src="/assets/vbox25.png" alt="vbox25.png" width="auto" height="auto" /></p> </details> <p>The next 3 steps will be very similar. refer to images if need be.</p> <p>Select <code class="language-plaintext highlighter-rouge">Adapter 2</code>. Tick the <em>Enable Network Adapter option</em>. For the Attached to option select <code class="language-plaintext highlighter-rouge">Internal Network</code>. For Name enter <code class="language-plaintext highlighter-rouge">LAN 0</code>. Expand the Advanced section. For Adapter Type select <code class="language-plaintext highlighter-rouge">Paravirtualized Network (virtio-net)</code>.</p> <p>Select <code class="language-plaintext highlighter-rouge">Adapter 3</code>. Tick the <em>Enable Network Adapter option</em>. For the Attached to option select <code class="language-plaintext highlighter-rouge">Internal Network</code>. For Name enter <code class="language-plaintext highlighter-rouge">LAN 1</code>. Expand the Advanced section. For Adapter Type select <code class="language-plaintext highlighter-rouge">Paravirtualized Network (virtio-net)</code>.</p> <p>Select <code class="language-plaintext highlighter-rouge">Adapter 4</code>. Tick the Enable Network Adapter option. For the Attached to option select <code class="language-plaintext highlighter-rouge">Internal Network</code>. For Name enter <code class="language-plaintext highlighter-rouge">LAN 2</code>. Expand the Advanced section. For Adapter Type select <code class="language-plaintext highlighter-rouge">Paravirtualized Network (virtio-net)</code>.</p> <p>Once done click on <code class="language-plaintext highlighter-rouge">OK</code> to save the changes and close the configuration menu.</p> <h2 id="virtualbox-network-settings"> <a href="#virtualbox-network-settings" class="anchor-heading" aria-labelledby="virtualbox-network-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">VirtualBox Network Settings</span> </h2> <p class="warning">VirtualBox by defualt only allows us to configure 4 interfaces using the UI. Towards the end of the guide we will see how to add more interfaces using VirtualBox Command line interface.</p> <p>Additionally, you can find a <a href="https://www.nakivo.com/blog/virtualbox-network-setting-guide/">Virtualbox Network Settings Guide</a> here.</p> <h2 id="pfsense-installation"> <a href="#pfsense-installation" class="anchor-heading" aria-labelledby="pfsense-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">pfSense Installation</span> </h2> <p>For the pfSense install, the installation process will just be hitting <code class="language-plaintext highlighter-rouge">next</code> quite a few times.</p> <ul> <li>To start select the pfSense VM from the sidebar and hit the <code class="language-plaintext highlighter-rouge">Start</code> icon.</li> </ul> <p><em>Please refer to the photos for confirmation</em></p> <ul> <li>Initally, an agreement will appear. <code class="language-plaintext highlighter-rouge">Press Enter</code> if you would like to Accept the agreement.</li> </ul> <p class="warning">Note you will have to accept the agreement to use the features of this machine.</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox26.png" alt="vbox26.png" width="auto" height="auto" /> <img src="/assets/vbox27.png" alt="vbox27.png" width="auto" height="auto" /> <img src="/assets/vbox28.png" alt="vbox28.png" width="auto" height="auto" /> <img src="/assets/vbox29.png" alt="vbox29.png" width="auto" height="auto" /> <img src="/assets/vbox30.png" alt="vbox30.png" width="auto" height="auto" /> <img src="/assets/vbox31.png" alt="vbox31.png" width="auto" height="auto" /> <img src="/assets/vbox32.png" alt="vbox32.png" width="auto" height="auto" /> <img src="/assets/vbox33.png" alt="vbox33.png" width="auto" height="auto" /></p> </details> <blockquote> <p>Press Enter to <code class="language-plaintext highlighter-rouge">start the Installation</code>.</p> </blockquote> <blockquote> <p>Press Enter to select the <code class="language-plaintext highlighter-rouge">Auto (ZFS) partition option</code>.</p> </blockquote> <blockquote> <p>Press Enter to select <code class="language-plaintext highlighter-rouge">Proceed with Installation</code>.</p> </blockquote> <blockquote> <p>Press Enter to select <code class="language-plaintext highlighter-rouge">Stripe - No Redundancy</code>.</p> </blockquote> <blockquote> <p>Use the Spacebar key to select the <code class="language-plaintext highlighter-rouge">Hard Drive (ada0)</code> then press Enter to continue.</p> </blockquote> <blockquote> <p>Use the Left Arrow to select YES and then press Enter to continue.</p> </blockquote> <blockquote> <p>Wait for the installation to complete.</p> </blockquote> <blockquote> <p>Press Enter to Reboot the VM.</p> </blockquote> <h2 id="pfsense-configuration-"> <a href="#pfsense-configuration-" class="anchor-heading" aria-labelledby="pfsense-configuration-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">pfSense Configuration </span> </h2> <p>Once pfSense reboots, the first priority is to configure the adapters we created in the VirtualBox settings.</p> <details> <summary> <span style="color: orange; font-weight: bold;">Image Ref. (click me!)</span> </summary> <p><img src="/assets/vbox26.png" alt="vbox26.png" width="auto" height="auto" /> <img src="/assets/vbox27.png" alt="vbox27.png" width="auto" height="auto" /> <img src="/assets/vbox28.png" alt="vbox28.png" width="auto" height="auto" /> <img src="/assets/vbox29.png" alt="vbox29.png" width="auto" height="auto" /> <img src="/assets/vbox30.png" alt="vbox30.png" width="auto" height="auto" /> <img src="/assets/vbox31.png" alt="vbox31.png" width="auto" height="auto" /> <img src="/assets/vbox32.png" alt="vbox32.png" width="auto" height="auto" /> <img src="/assets/vbox33.png" alt="vbox33.png" width="auto" height="auto" /></p> </details> <blockquote> <p>Should VLANs be set up now? <code class="language-plaintext highlighter-rouge">n</code></p> </blockquote> <blockquote> <p>In the next step, we will configure the interfaces manually.</p> </blockquote> <p>Enter the WAN interface name: <code class="language-plaintext highlighter-rouge">vtnet0</code></p> <p>Enter the LAN interface name: <code class="language-plaintext highlighter-rouge">vtnet1</code></p> <p>Enter the Optional 1 interface name: <code class="language-plaintext highlighter-rouge">vtnet2</code></p> <p>Enter the Optional 2 interface name: <code class="language-plaintext highlighter-rouge">vtnet3</code></p> <p>Do you want to proceed?: <code class="language-plaintext highlighter-rouge">y</code></p> <p>Since the <code class="language-plaintext highlighter-rouge">WAN</code> interface of pfSense is managed by VirtualBox, it has been assigned an IPv4 address by the VirtualBox DHCP server. pfSense has also assigned an IPv4 address to the <code class="language-plaintext highlighter-rouge">LAN</code> interface using its own DHCP service. The <code class="language-plaintext highlighter-rouge">OPT1</code> and <code class="language-plaintext highlighter-rouge">OPT2</code> interfaces have not been assigned any IP address yet. We do not want the IP addresses of the interfaces to change on boot.</p> <ul> <li>Next we will assign static IPv4 addresses to the <code class="language-plaintext highlighter-rouge">LAN</code>, <code class="language-plaintext highlighter-rouge">OPT1</code> and <code class="language-plaintext highlighter-rouge">OPT2</code> interfaces.</li> </ul> <p class="warning">The IP address of the <code class="language-plaintext highlighter-rouge">WAN</code> interface can be different in your case since it is assignment randomly by the VirtualBox DHCP server.</p> <h2 id="configuring-lan-vtnet1"> <a href="#configuring-lan-vtnet1" class="anchor-heading" aria-labelledby="configuring-lan-vtnet1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Configuring LAN (vtnet1)</span> </h2> <blockquote> <p>Enter <code class="language-plaintext highlighter-rouge">2</code> to select “Set interface(s) IP address”.</p> </blockquote> <p>Then again,</p> <blockquote> <p>Enter <code class="language-plaintext highlighter-rouge">2</code> to select the LAN interface.</p> </blockquote> <p>Configure IPv4 address LAN interface via DHCP?: <code class="language-plaintext highlighter-rouge">n</code></p> <p>Enter the new LAN IPv4 address: <code class="language-plaintext highlighter-rouge">10.0.0.1</code></p> <p>Enter the new LAN IPv4 subnet bit count: <code class="language-plaintext highlighter-rouge">24</code></p> <p><img src="/assets/vbox34.png" alt="vbox34.png" width="auto" height="auto" /></p><hr /> <blockquote> <p>For the next question just press <code class="language-plaintext highlighter-rouge">Enter</code> for none.</p> </blockquote> <p>Because this is a <code class="language-plaintext highlighter-rouge">LAN</code> interface, we will not have to worry about configuring the upstream gateway.</p> <p>Configure IPv6 address LAN interface via DHCP6: <code class="language-plaintext highlighter-rouge">n</code></p> <p>For the new LAN IPv6 address question press <code class="language-plaintext highlighter-rouge">Enter</code></p> <p>Do you want to enable the DHCP server on LAN?: <code class="language-plaintext highlighter-rouge">y</code></p> <p>Enter the start address of the IPv4 client address range: <code class="language-plaintext highlighter-rouge">10.0.0.11</code></p> <p>Enter the end address of the IPv4 client address range: <code class="language-plaintext highlighter-rouge">10.0.0.243</code></p> <p>Do you want to revert to HTTP as the webConfigurator protocol?: <code class="language-plaintext highlighter-rouge">n</code></p> <p><img src="/assets/vbox35.png" alt="vbox35.png" width="auto" height="auto" /></p><hr /> <p>pfSense will use the inputs we provided and automatically configure the interface.</p> <blockquote> <p>Press <code class="language-plaintext highlighter-rouge">Enter</code> to complete the <code class="language-plaintext highlighter-rouge">LAN</code> interface configuration.</p> </blockquote> <p><img src="/assets/vbox36.png" alt="vbox36.png" width="auto" height="auto" /></p> <h2 id="configuring-opt1-vtnet2"> <a href="#configuring-opt1-vtnet2" class="anchor-heading" aria-labelledby="configuring-opt1-vtnet2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Configuring OPT1 (vtnet2)</span> </h2> <p>Enter <code class="language-plaintext highlighter-rouge">2</code> to select “Set interface(s) IP address”. Enter <code class="language-plaintext highlighter-rouge">3</code> this time in order to select the <code class="language-plaintext highlighter-rouge">OPT1</code> interface.</p> <p>Configure IPv4 address OPT1 interface via DHCP?: <code class="language-plaintext highlighter-rouge">n</code></p> <p>Enter the new OPT1 IPv4 address: <code class="language-plaintext highlighter-rouge">10.6.6.1</code></p> <p>Enter the new OPT1 IPv4 subnet bit count: <code class="language-plaintext highlighter-rouge">24</code></p> <p><img src="/assets/vbox37.png" alt="vbox37.png" width="auto" height="auto" /></p><hr /> <blockquote> <p>For the next question directly press <code class="language-plaintext highlighter-rouge">Enter</code>.</p> </blockquote> <p>Since <code class="language-plaintext highlighter-rouge">OPT1</code> is a <code class="language-plaintext highlighter-rouge">LAN</code> interface we do not have to worry about configuring the upstream gateway.</p> <p>Configure IPv6 address OPT1 interface via DHCP6: <code class="language-plaintext highlighter-rouge">n</code></p> <p>For the new OPT1 IPv6 address question press <code class="language-plaintext highlighter-rouge">Enter</code></p> <p>Do you want to enable the DHCP server on OPT1?: <code class="language-plaintext highlighter-rouge">y</code></p> <p>Enter the start address of the IPv4 client address range: <code class="language-plaintext highlighter-rouge">10.6.6.11</code></p> <p>Enter the end address of the IPv4 client address range: <code class="language-plaintext highlighter-rouge">10.6.6.243</code></p> <p>Do you want to revert to HTTP as the webConfigurator protocol?: <code class="language-plaintext highlighter-rouge">n</code></p> <p>Press <code class="language-plaintext highlighter-rouge">Enter</code> to save the changes and return to the main menu.</p> <h2 id="configuring-opt1-vtnet3"> <a href="#configuring-opt1-vtnet3" class="anchor-heading" aria-labelledby="configuring-opt1-vtnet3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Configuring OPT1 (vtnet3)</span> </h2> <p>Enter <code class="language-plaintext highlighter-rouge">2</code> to select “Set interface(s) IP address”. Enter <code class="language-plaintext highlighter-rouge">4</code> to select the <code class="language-plaintext highlighter-rouge">OPT2</code> interface.</p> <p>Configure IPv4 address OPT2 interface via DHCP?: <code class="language-plaintext highlighter-rouge">n</code></p> <p>Enter the new OPT2 IPv4 address: <code class="language-plaintext highlighter-rouge">10.80.80.1</code></p> <p>Enter the new OPT2 IPv4 subnet bit count: <code class="language-plaintext highlighter-rouge">24</code></p> <p><img src="/assets/vbox38.png" alt="vbox38.png" width="auto" height="auto" /></p><hr /> <blockquote> <p>For the next question directly press <code class="language-plaintext highlighter-rouge">Enter</code>.</p> </blockquote> <p>Since <code class="language-plaintext highlighter-rouge">OPT2</code> is a <code class="language-plaintext highlighter-rouge">LAN</code> interface we do not have to worry about configuring the upstream gateway.</p> <p>Configure IPv6 address OPT2 interface via DHCP6: <code class="language-plaintext highlighter-rouge">n</code></p> <p>For the new OPT2 IPv6 address question press <code class="language-plaintext highlighter-rouge">Enter</code></p> <p>Do you want to enable the DHCP server on OPT2?: <code class="language-plaintext highlighter-rouge">n</code></p> <p class="warning">OPT2 will be used for the Active Directory (AD) Lab. The Domain Controller (DC) in the lab will act as the DHCP server. Since the DC will perform DHCP, this is why we have disabled DHCP IP address assignment for this interface in pfSense.</p> <p>Do you want to revert to HTTP as the webConfigurator protocol?: <code class="language-plaintext highlighter-rouge">n</code></p> <p><img src="/assets/vbox39.png" alt="vbox39.png" width="auto" height="auto" /></p> <h2 id="final-checks"> <a href="#final-checks" class="anchor-heading" aria-labelledby="final-checks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Final Checks!</span> </h2> <p>Press <code class="language-plaintext highlighter-rouge">Enter</code> to save the changes and return to the main menu.</p> <p>The IP addresses for the <code class="language-plaintext highlighter-rouge">LAN</code>, <code class="language-plaintext highlighter-rouge">OPT1</code> and <code class="language-plaintext highlighter-rouge">OPT2</code> interfaces should be as follows:</p> <p><img src="/assets/vbox40.png" alt="vbox40.png" width="auto" height="auto" /></p> <p>Once confirmed, we have completed the configuration of the interfaces for our pfSense. However, there are still some additional settings that need to be configured. We will change these settings once we set up Kali Linux in the next module. From Kali Linux, we will access the pfSense Web Interface and proceed from there.</p> <p class="warning">pfSense Web Interface can be accessible for all the <code class="language-plaintext highlighter-rouge">LAN</code> interfaces in our <code class="language-plaintext highlighter-rouge">LAN</code>!</p> <h2 id="shutdown-pfsense"> <a href="#shutdown-pfsense" class="anchor-heading" aria-labelledby="shutdown-pfsense"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Shutdown pfSense</span> </h2> <p>When we start the lab pfSense is the first VM that has to be booted. When we shut down the lab pfSense will be the <strong><em>last</em></strong> VM that is stopped.</p> <blockquote> <p>From the Main Menu</p> </blockquote> <p>Enter the option: <code class="language-plaintext highlighter-rouge">6</code> (Halt system)</p> <p>Do you want to process?: <code class="language-plaintext highlighter-rouge">y</code></p> <p>This will initiate the shutdown sequence.</p> <h2 id="post-installation-cleanup"> <a href="#post-installation-cleanup" class="anchor-heading" aria-labelledby="post-installation-cleanup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Post-Installation Cleanup</span> </h2> <p>After the VM is shut down. Click on Settings from the toolbar.</p> <p>Go to the <code class="language-plaintext highlighter-rouge">Storage</code> tab. In the Storage Devices section click on the pfSense <code class="language-plaintext highlighter-rouge">.iso</code> image then click on the small disk image on the right side of the Optical Drive option.</p> <p>From the dropdown select <code class="language-plaintext highlighter-rouge">Remove Disk</code> from <code class="language-plaintext highlighter-rouge">Virtual Drive</code>. Click on <code class="language-plaintext highlighter-rouge">OK</code> to save the changes and close the configuration menu.</p> <p>The .iso file along with the .iso.gz file that was downloaded to create the VM can be deleted if you do not want to store them.</p> <p>In the next module, we will set up <code class="language-plaintext highlighter-rouge">Kali Linux</code> on the <code class="language-plaintext highlighter-rouge">LAN</code> interface. This VM will be used to configure and manage pfSense. It will also be used as the attack VM to target the vulnerable systems on the <code class="language-plaintext highlighter-rouge">OPT1</code> (CYBER_RANGE).</p> <h3 id="home-lab-part-3"> <a href="#home-lab-part-3" class="anchor-heading" aria-labelledby="home-lab-part-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="/security/2024-05-16-homelabpart3/" class="btn btn-green">Home Lab Part 3</a> </h3> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
