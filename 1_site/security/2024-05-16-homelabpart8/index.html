<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav ul li a { background-image: none; } .site-nav > ul.nav-category-list > li > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Building a VirtualBox Home Lab: Secure Network Topology Part 1 | Home</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Building a VirtualBox Home Lab: Secure Network Topology Part 1" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Network &amp; Security Home Lab:" /> <meta property="og:description" content="Network &amp; Security Home Lab:" /> <link rel="canonical" href="https://sigsandor.github.io/security/2024-05-16-homelabpart8/" /> <meta property="og:url" content="https://sigsandor.github.io/security/2024-05-16-homelabpart8/" /> <meta property="og:site_name" content="Home" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-05-16T00:00:00-04:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Building a VirtualBox Home Lab: Secure Network Topology Part 1" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-05-16T00:00:00-04:00","datePublished":"2024-05-16T00:00:00-04:00","description":"Network &amp; Security Home Lab:","headline":"Building a VirtualBox Home Lab: Secure Network Topology Part 1","mainEntityOfPage":{"@type":"WebPage","@id":"https://sigsandor.github.io/security/2024-05-16-homelabpart8/"},"url":"https://sigsandor.github.io/security/2024-05-16-homelabpart8/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Home </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/CHANGELOG.html" class="nav-list-link">Changelog</a></li></ul> <div class="nav-category">Security</div> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Network & Security Home Lab category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/security/2024-05-15-homelabpart1/" class="nav-list-link">Network & Security Home Lab</a><ul class="nav-list"><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart2/" class="nav-list-link">Part 2 - pfSense Setup & Configuration</a></li><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart3/" class="nav-list-link">Part 3 - Parrot Security (Linux setup)</a></li><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart4/" class="nav-list-link">Part 4 - pfSense Firewall configuration</a></li><li class="nav-list-item"><a href="/security/2024-07-04-homelabpart5/" class="nav-list-link">Part 5 - Cyber Range setup</a></li><li class="nav-list-item"><a href="/security/2024-07-15-homelabpart6/" class="nav-list-link">Part 6 - Active Directory Setup</a></li></ul></li><li class="nav-list-item"><a href="/security/2024-5-26-DMARC/" class="nav-list-link">Email Authentication: DMARC</a></li><li class="nav-list-item"><a href="/security/2024-06-18-KQLbasics/" class="nav-list-link">KQL basics</a></li><li class="nav-list-item"><a href="/security/2022-05-19-links/" class="nav-list-link">Useful Cybersecurity links</a></li></ul> <div class="nav-category">Networking</div> <ul class="nav-list"><li class="nav-list-item"><a href="/networking/2024-06-22-NetworkingProtocols/" class="nav-list-link">Networking 101</a></li></ul> <div class="nav-category">Personal</div> <ul class="nav-list"><li class="nav-list-item"><a href="/personal/2020-05-21-dusunre/" class="nav-list-link">Online History</a></li><li class="nav-list-item"><a href="/personal/2024-05-16-explorepics/" class="nav-list-link">Photo collection</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Home" aria-label="Search Home" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://www.linkedin.com/in/alex-barkman-b7b26a186/" class="site-button" > Linkedin </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/sigSandor" class="site-button" > Github </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/security/2024-05-15-homelabpart1/">Network & Security Home Lab</a></li> <li class="breadcrumb-nav-list-item"><span>Building a VirtualBox Home Lab: Secure Network Topology Part 1</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h2 id="network--security-home-lab"> <a href="#network--security-home-lab" class="anchor-heading" aria-labelledby="network--security-home-lab"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Network &amp; Security Home Lab: </h2> <h3 id="part-1---secure-network-topology"> <a href="#part-1---secure-network-topology" class="anchor-heading" aria-labelledby="part-1---secure-network-topology"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: pink; font-weight: bold;">Part 1 - Secure Network Topology</span> </h3> <p><img src="/assets/banner.jpg" alt="banner" width="auto" height="auto" /></p> <h6 id="posted-may-15-2024"> <a href="#posted-may-15-2024" class="anchor-heading" aria-labelledby="posted-may-15-2024"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Posted <strong><em>May 15, 2024</em></strong> </h6> <p>Building a Virtual Security Home Lab: Part 8 - Malware Analysis Lab Setup</p> <p>In the module, we are going to set up the Malware Analysis Lab. This lab will consist of two VMs. One of the VMs will be for Windows Malware Analysis and the other one will be for Linux Malware Analysis.</p> <h2 id="creating-new-interface"> <a href="#creating-new-interface" class="anchor-heading" aria-labelledby="creating-new-interface"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Creating New Interface</span> </h2> <p>VirtualBox GUI does not allow us to create more than four Network Interfaces.</p> <p>However, we can configure up to 8 interfaces per VM. To add more than 4 interfaces we have to utilize the VirtualBox CLI.</p> <h2 id="virtualbox-cli-setup"> <a href="#virtualbox-cli-setup" class="anchor-heading" aria-labelledby="virtualbox-cli-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">VirtualBox CLI Setup</span> </h2> <p>The VirtualBox CLI binary is called VBoxManage.exe.</p> <p>To be able to use the CLI we have to add its path as an environment variable. VirtualBox is by default installed at C:\Program Files\Oracle\VirtualBox.</p> <p>Copy the path to the executable from the navigation bar.</p> <p>Open Search and type “Environment”. Click on Edit environment variables for your account.</p> <p>In the top window select the variable named “Path” and then click on Edit.</p> <p>Click on New and then paste the path to the VirtualBox CLI. Then click on OK.</p> <p>Click on OK to close the Environment Variables menu.</p> <p>To test if the variable was added successfully open PowerShell and run the following command:</p> <h1 id="list-all-installed-vms"> <a href="#list-all-installed-vms" class="anchor-heading" aria-labelledby="list-all-installed-vms"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> List all installed VMs </h1> <p>VBoxManage list vms</p> <p>Creating new Interface</p> <p>Before we create the new interfaces we need to know the name of the pfSense VM (it is “pfSense” in my case). The VM should also be “Powered Off”.</p> <p>To add a network interface run the following commands:</p> <h1 id="create-a-internet-network"> <a href="#create-a-internet-network" class="anchor-heading" aria-labelledby="create-a-internet-network"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a Internet Network </h1> <p>VBoxManage modifyvm “pfSense” –nic5 intnet</p> <h1 id="use-the-paravirtualized-adapter"> <a href="#use-the-paravirtualized-adapter" class="anchor-heading" aria-labelledby="use-the-paravirtualized-adapter"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use the Paravirtualized Adapter </h1> <p>VBoxManage modifyvm “pfSense” –nictype5 virtio</p> <h1 id="give-it-the-name-lan-3"> <a href="#give-it-the-name-lan-3" class="anchor-heading" aria-labelledby="give-it-the-name-lan-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Give it the name LAN 3 </h1> <p>VBoxManage modifyvm “pfSense” –intnet5 “LAN 3”</p> <h1 id="network-interface-is-connected-by-cable"> <a href="#network-interface-is-connected-by-cable" class="anchor-heading" aria-labelledby="network-interface-is-connected-by-cable"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Network Interface is connected by Cable </h1> <p>VBoxManage modifyvm “pfSense” –cableconnected5 on</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>In the above commands “pfSense” is the name of my VM.
In the 3rd command in place of “LAN 3” you can use a different name that matches your network interface naming convention.
</code></pre></div></div> <p>Now if we look at the overview of the pfSense VM we should see Adapter 5.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Interfaces that are created using the CLI will not show up in the Settings page for the VM. If you want to modify the adapter settings you have to do it using the CLI.
</code></pre></div></div> <h3 id="enabling-the-interface"> <a href="#enabling-the-interface" class="anchor-heading" aria-labelledby="enabling-the-interface"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Enabling the Interface</span> </h3> <p>Start the pfSense VM. On boot, you will notice that there are still only 4 interfaces. The new interface has to be onboarded before it shows up in pfSense.</p> <p>Enter 1 to select “Assign Interfaces”. Should VLANs be set up now? n</p> <p>Enter the WAN interface name: vtnet0 Enter the LAN interface name: vtnet1 Enter the Optional 1 interface name: vtnet2 Enter the Optional 2 interface name: vtnet3 Enter the Optional 3 interface name: vtnet4</p> <p>Do you want to proceed?: y</p> <p>The new interface has been added. Now we need to assign the interface an IP address.</p> <p>Enter 2 to select “Set interface(s) IP address” Enter 5 to select the OPT3 interface.</p> <p>Configure IPv4 address OPT3 interface via DHCP?: n Enter the new OPT3 IPv4 address: 10.99.99.1 Enter the new OPT3 IPv4 subnet bit count: 24</p> <p>For the next question press Enter. Since we are configuring a LAN interface we do not have to worry about the upstream gateway.</p> <p>Configure IPv6 address OPT3 interface via DHCP6: n For the new OPT3 IPv6 address question press Enter. Do you want to enable the DHCP server on OPT3?: y Enter the start address of the IPv4 client address range: 10.99.99.11 Enter the end address of the IPv4 client address range: 10.99.99.243 Do you want to revert to HTTP as the webConfigurator protocol?: n</p> <p>Now interface OPT3 will have an IP address.</p> <h3 id="renaming-the-interface"> <a href="#renaming-the-interface" class="anchor-heading" aria-labelledby="renaming-the-interface"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Renaming the Interface</span> </h3> <p>Launch the Kali Linux VM. Login to the pfSense web portal. From the navigation bar select Interfaces -&gt; OPT3.</p> <p>In the description field enter ISOLATED. Scroll to the bottom and click on Save.</p> <p>Click on Apply Changes in the popup that appears to persist the changes.</p> <h3 id="interface-firewall-configuration"> <a href="#interface-firewall-configuration" class="anchor-heading" aria-labelledby="interface-firewall-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Interface Firewall Configuration</span> </h3> <p>From the navigation bar click on Firewall -&gt; Rules.</p> <p>Select the ISOLATED tab. Click on the “Add” button to create a new rule.</p> <p>Change the values as follows: Action: Block Address Family: IPv4+IPv6 Protocol: Any Source: ISOLATED subnets Description: Block access to everything</p> <p>Scroll to the bottom and click on Save.</p> <p>In the popup click on Apply Changes to persist the new rule.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Since this Interface is going to be used for Malware Analysis we are blocking network access. This will ensure that malware cannot spread to other systems using the network.
</code></pre></div></div> <h3 id="reboot-pfsense"> <a href="#reboot-pfsense" class="anchor-heading" aria-labelledby="reboot-pfsense"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Reboot pfSense</span> </h3> <p>Now we need to restart pfSense to ensure that the firewall rules are propagated properly. From the navigation bar select Diagnostics -&gt; Reboot.</p> <p>Click on Submit.</p> <p>Once pfSense boots up you will be redirected to the login page.</p> <h2 id="flare-vm-setup"> <a href="#flare-vm-setup" class="anchor-heading" aria-labelledby="flare-vm-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Flare VM Setup</span> </h2> <p>To install Flare we need a Windows machine. Flare can be set up using most versions of Windows. Since we already have the ISO for Windows 10 Enterprise I will be using it to configure Flare.</p> <h3 id="windows-iso-download"> <a href="#windows-iso-download" class="anchor-heading" aria-labelledby="windows-iso-download"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Windows ISO Download</span> </h3> <div class="table-wrapper"><table> <tbody> <tr> <td>Go to the following URL: Windows 10 Enterprise</td> <td>Microsoft Evaluation Center</td> </tr> </tbody> </table></div> <p>Click on the 64-bit edition Enterprise ISO download option. The ISO file is ~5GB.</p> <h3 id="creating-the-vm"> <a href="#creating-the-vm" class="anchor-heading" aria-labelledby="creating-the-vm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating the VM </h3> <p>Select Tools from the sidebar and click on New.</p> <p>Give the VM a name. Select the downloaded Windows 10 ISO Image. Check “Skip Unattended Installation”. Then click on Next.</p> <p>Increase Base Memory to 4096MB and click on Next.</p> <p>Increase the Drive Size to 100GB and click on Next.</p> <p>Verify all the settings and click on Finish.</p> <p>Adding VM to Group</p> <p>Right-click on the VM and select Move to Group -&gt; [New].</p> <p>Right-click on the group and rename it to “Malware Analysis”.</p> <p>Right-click on the “Malware Analysis” group and select Move to Group -&gt; Home Lab.</p> <p>The final result should look as follows:</p> <h3 id="configuring-the-vm"> <a href="#configuring-the-vm" class="anchor-heading" aria-labelledby="configuring-the-vm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Configuring the VM</span> </h3> <p>Select the VM then from the toolbar select Settings.</p> <p>Go to System -&gt; Motherboard. In the Boot Order field ensure that Hard Disk is on the top followed by Optical. Uncheck Floppy.</p> <p>Leave the Network Adatper on its default setting of NAT.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Machines assigned to the ISOLATED interface does not have internet connection. But to setup Flare we need Internet access. Once we finish the configuring Flare we will move it to the correct subnet.
</code></pre></div></div> <p>Click on OK to save the settings.</p> <h3 id="installing-windows"> <a href="#installing-windows" class="anchor-heading" aria-labelledby="installing-windows"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Installing Windows</span> </h3> <p>Select the Flare VM from the sidebar and click on Start.</p> <p>Install Windows as shown below. The installation process is identical to the process from the previous module (Part 7).</p> <p>Select “Domain join instead”.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Provide a name that does not use special characters and spaces. This is very important. The installer for Flare will not work otherwise.
</code></pre></div></div> <p>Once on the desktop Windows will ask should access to the Internet be allowed click on Yes.</p> <h3 id="guest-additions-installation"> <a href="#guest-additions-installation" class="anchor-heading" aria-labelledby="guest-additions-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Guest Additions Installation</span> </h3> <p>Install Guest Additions to enable the resizing on the VM display. Once again you can refer to the last module (Part 7) for more detailed steps.</p> <p>After rebooting the VM. Remove the Guest Addition Image.</p> <h3 id="creating-vm-snapshot-1"> <a href="#creating-vm-snapshot-1" class="anchor-heading" aria-labelledby="creating-vm-snapshot-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating VM Snapshot 1 </h3> <p>Before we proceed we are going to take a snapshot of the VM. Snapshots allow us to roll back to an old functional state of the VM.</p> <p>Shut down the VM. Click on the Hamburger menu on the right of the VM name in the sidebar. Select Snapshots.</p> <p>Click on Take.</p> <p>Give the Snapshot a descriptive name. Click on OK to create the Snapshot.</p> <p>Click on the Hamburger menu and click on Details to return to the original page.</p> <h3 id="flare-vm-pre-install-configuration"> <a href="#flare-vm-pre-install-configuration" class="anchor-heading" aria-labelledby="flare-vm-pre-install-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Flare VM Pre-Install Configuration </h3> <p>You can read more about Flare VM and its pre-requisites on the below link: mandiant/flare-vm: A collection of scripts to setup a reverse engineering environment</p> <p>TLDR; “Windows Updates” and “Windows Defender” have to be disabled.</p> <h4 id="disabling-windows-update"> <a href="#disabling-windows-update" class="anchor-heading" aria-labelledby="disabling-windows-update"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Disabling Windows Update </h4> <div class="table-wrapper"><table> <tbody> <tr> <td>How to change account password on Windows 11</td> <td>Windows Central</td> </tr> </tbody> </table></div> <p>Open on Search bar and search for “Settings”. Open the Settings app.</p> <p>Click on “Update &amp; Security”.</p> <p>Click on the “Pause updates for 7 days” button.</p> <h4 id="disabling-windows-defender"> <a href="#disabling-windows-defender" class="anchor-heading" aria-labelledby="disabling-windows-defender"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Disabling Windows Defender </h4> <p>Download the following script: jeremybeaume/tools: Script to disable Windows Defender</p> <p>Right-click on the Shield icon on the taskbar and select “View Security Dashboard”.</p> <p>Click on “Virus &amp; threat protection”.</p> <p>Select “Manage settings” from the “Virus &amp; threat protection settings” section.</p> <p>Disable all the features that are shown in the image below:</p> <p>Right-click on the Start menu and select “Windows PowerShell (Admin)”.</p> <p>Run the following command to download the script:</p> <h1 id="save-the-script-in-the-downloads-folder"> <a href="#save-the-script-in-the-downloads-folder" class="anchor-heading" aria-labelledby="save-the-script-in-the-downloads-folder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Save the script in the Downloads folder </h1> <p>Invoke-WebRequest “https://raw.githubusercontent.com/jeremybeaume/tools/master/disable-defender.ps1” -OutFile $HOME\Downloads\disable-defender.ps1</p> <p>Use the shortcut Windows+R to open the Run dialog. Enter msconfig and click on OK.</p> <p>Navigate to the Boot tab. In the Boot options section enable “Safe boot” and then click on OK to save changes.</p> <p>Click on Restart to boot into Safe Mode.</p> <p>In Safe Mode, the VM cannot be resizable. Safe Mode essentially disables all features that are not required to run the OS.</p> <p>Right-click on the Start menu and select “Windows PowerShell (Admin)” and enter the following commands:</p> <h1 id="change-directory"> <a href="#change-directory" class="anchor-heading" aria-labelledby="change-directory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Change directory </h1> <p>cd .\Downloads\</p> <h1 id="unblock-the-downloaded-script"> <a href="#unblock-the-downloaded-script" class="anchor-heading" aria-labelledby="unblock-the-downloaded-script"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unblock the downloaded script </h1> <p>Unblock-File .\disable-defender.ps1</p> <h1 id="disable-the-powershell-policy-preventing-script-execution"> <a href="#disable-the-powershell-policy-preventing-script-execution" class="anchor-heading" aria-labelledby="disable-the-powershell-policy-preventing-script-execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Disable the PowerShell policy preventing script execution </h1> <p>Set-ExecutionPolicy Unrestricted -Force</p> <h1 id="start-the-script"> <a href="#start-the-script" class="anchor-heading" aria-labelledby="start-the-script"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Start the script </h1> <p>.\disable-defender.ps1</p> <p>Once the script completes its execution press Enter to close the script. Reboot the VM for the changes to take place.</p> <p>Press Windows+R to open the Run dialog. Enter msconfig and click on OK.</p> <p>Navigate to the Boot tab. From the Boot options section disable “Safe boot”. Click on Apply then OK. Restart the VM to boot normally into Windows.</p> <p>Wait for some time for Defender to load completely and then you will see that “Virus &amp; threat protection” will show as disabled. This means that the script worked successfully.</p> <h3 id="renaming-the-vm"> <a href="#renaming-the-vm" class="anchor-heading" aria-labelledby="renaming-the-vm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Renaming the VM </h3> <p>Search for “This PC” and from the right side click on “Properties”.</p> <p>Select “Rename this PC”.</p> <p>Give the PC a name. Click on Next and then select “Restart Now” for the changes to take effect.</p> <h3 id="creating-vm-snapshot-2"> <a href="#creating-vm-snapshot-2" class="anchor-heading" aria-labelledby="creating-vm-snapshot-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating VM Snapshot 2 </h3> <p>Shut down the VM. Go to the Snapshot page using the Hamburger menu. Click on Take to create a new Snapshot.</p> <p>Give the Snapshot a descriptive name. Then click on OK.</p> <p>Use the Hamburger menu and return to the Details page. Click on Start to start the VM.</p> <h2 id="flare-vm-installation"> <a href="#flare-vm-installation" class="anchor-heading" aria-labelledby="flare-vm-installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Flare VM Installation</span> </h2> <p>Right-click on the Start menu and select “Windows PowerShell (Admin)”.</p> <p>Enter the following commands to download and run the Flare VM script.</p> <h1 id="download-the-flarevm-script"> <a href="#download-the-flarevm-script" class="anchor-heading" aria-labelledby="download-the-flarevm-script"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Download the FlareVM script </h1> <p>Invoke-WebRequest “https://raw.githubusercontent.com/mandiant/flare-vm/main/install.ps1” -OutFile $HOME/Downloads/install.ps1</p> <h1 id="go-to-downloads-folder"> <a href="#go-to-downloads-folder" class="anchor-heading" aria-labelledby="go-to-downloads-folder"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Go to Downloads Folder </h1> <p>cd $HOME/Downloads</p> <h1 id="unlock-the-downlaoded-script"> <a href="#unlock-the-downlaoded-script" class="anchor-heading" aria-labelledby="unlock-the-downlaoded-script"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unlock the downlaoded script </h1> <p>Unblock-File .\install.ps1</p> <h1 id="disable-powershell-script-execution-policy"> <a href="#disable-powershell-script-execution-policy" class="anchor-heading" aria-labelledby="disable-powershell-script-execution-policy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Disable PowerShell script execution policy </h1> <p>Set-ExecutionPolicy Unrestricted -Force</p> <h1 id="run-the-script"> <a href="#run-the-script" class="anchor-heading" aria-labelledby="run-the-script"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Run the script </h1> <p>.\install.ps1</p> <p>The script will make some checks before starting the installation.</p> <p>Enter Y when asked about Snapshot. Enter password when prompted.</p> <p>After some time the Flare VM configuration dialog will open.</p> <p>In the Package Installation Customization section from the left side select “debloat.vm” and click on the right arrow to select it for installation.</p> <p>Click on OK to start the install. The VM will restart multiple times during the setup.</p> <p>The installation can take a very long time. Once the setup is complete we will get the following prompt click on Finish to complete the setup.</p> <p>After the installation is complete. Restart the VM to complete the setup.</p> <h2 id="post-install-configuration"> <a href="#post-install-configuration" class="anchor-heading" aria-labelledby="post-install-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Post-Install Configuration</span> </h2> <h3 id="installing-openssh-server"> <a href="#installing-openssh-server" class="anchor-heading" aria-labelledby="installing-openssh-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installing OpenSSH Server </h3> <p>Once we move this VM to the ISOLATED subnet it will not be able to access the internet. We will not be able to download malware samples directly from the Internet. We will download the samples onto a different VM that has Internet access and then move them to this machine using SSH. I will cover this process in more detail in a later module. For now, we need to install “OpenSSH Server”.</p> <p>Open the Search bar. Type “Add” and from the results select the “Add or remove programs” option.</p> <p>Click on Optional Features under “Apps &amp; features”.</p> <p>Click on Add a feature. This will open a new menu.</p> <p>Search for “SSH”. Enable “OpenSSH Server” and then click on Install.</p> <p>Once the install is complete if you search for “SSH” in the “Installed features” section you should see “OpenSSH Client” and “OpenSSH Server”.</p> <h2 id="moving-vm-to-the-isolated-network"> <a href="#moving-vm-to-the-isolated-network" class="anchor-heading" aria-labelledby="moving-vm-to-the-isolated-network"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Moving VM to the Isolated Network</span> </h2> <p>Shut down the VM. Open the VM Settings page and go to Network. For the Attached to field select Internal Network. For name select LAN 3. Click on OK to save the changes.</p> <h3 id="creating-vm-snapshot-3"> <a href="#creating-vm-snapshot-3" class="anchor-heading" aria-labelledby="creating-vm-snapshot-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating VM Snapshot 3 </h3> <p>Using the Hamburger menu open the Snapshot page. Click on Take to create a Snapshot. Give the Snapshot a descriptive name and then click on Ok.</p> <p>You can now delete the Windows 10 Enterprise ISO if you do not plan to store it in the future.</p> <h2 id="remnux-vm-setup"> <a href="#remnux-vm-setup" class="anchor-heading" aria-labelledby="remnux-vm-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">REMnux VM Setup</span> </h2> <h3 id="download-image"> <a href="#download-image" class="anchor-heading" aria-labelledby="download-image"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Download Image </h3> <p>Go to the following link: Get the Virtual Appliance - REMnux Documentation</p> <p>Click on Box to open the download page.</p> <p>Click on the blue Download button. The image is ~5GB.</p> <p>Once the download is complete we will have an .ova file.</p> <h3 id="creating-the-vm-1"> <a href="#creating-the-vm-1" class="anchor-heading" aria-labelledby="creating-the-vm-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating the VM </h3> <p>Click on Tools from the sidebar and then select Import.</p> <p>Select the downloaded OVA file and click on Next.</p> <p>Configure the VM as required. Ensure the VM has 4096MB of RAM. For the MAC Address Policy select “Generate new MAC addresses for all network adapters” then click on Finish.</p> <h3 id="adding-vm-to-group"> <a href="#adding-vm-to-group" class="anchor-heading" aria-labelledby="adding-vm-to-group"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Adding VM to Group </h3> <p>Once the import is complete right-click on the VM and select Move to Group -&gt; Home Lab/Malware Analysis.</p> <h3 id="configuring-the-vm-1"> <a href="#configuring-the-vm-1" class="anchor-heading" aria-labelledby="configuring-the-vm-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring the VM </h3> <p>Select the VM then click on Settings from the toolbar.</p> <p>Go to System -&gt; Motherboard. In Boot Order ensure that Hard Disk is on the top followed by Optical. Uncheck Floppy. Click on OK to save the changes.</p> <h3 id="post-install-configuration-1"> <a href="#post-install-configuration-1" class="anchor-heading" aria-labelledby="post-install-configuration-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Post-Install Configuration </h3> <p>Select the VM and from the toolbar click on Start.</p> <h3 id="updating-guest-additions"> <a href="#updating-guest-additions" class="anchor-heading" aria-labelledby="updating-guest-additions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Updating Guest Additions </h3> <p>The VM will already have Guest Additions installed but it will be an older version. From the VM toolbar select Devices -&gt; Upgrade Guest Additions to update Guest Additions.</p> <h3 id="upgrading-packages"> <a href="#upgrading-packages" class="anchor-heading" aria-labelledby="upgrading-packages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Upgrading Packages </h3> <p>Once Guest Additions is updated open a Terminal and enter the following command to update the system packages.</p> <p>remnux upgrade</p> <p>Once the update is complete restart the VM.</p> <h2 id="moving-vm-to-the-isolated-network-1"> <a href="#moving-vm-to-the-isolated-network-1" class="anchor-heading" aria-labelledby="moving-vm-to-the-isolated-network-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">Moving VM to the Isolated Network</span> </h2> <p>Shut down the VM. Open the Settings menu and select Network.</p> <p>For the Attached to option select Internal Network. For the name field select LAN 3. Click on OK to save the changes. This will move the VM to the ISOLATED interface that does not have internet access.</p> <h3 id="creating-vm-snapshot"> <a href="#creating-vm-snapshot" class="anchor-heading" aria-labelledby="creating-vm-snapshot"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating VM Snapshot </h3> <p>Click on the Hamburger menu and select Snapshot.</p> <p>Click on Take to create a Snapshot.</p> <p>Give the Snapshot a descriptive name. Then click on OK.</p> <p>Use the Hamburger menu to go back to the Details page.</p> <p>In the next, module we will start configuring the Security subnet. This subnet will have our DFIR VM and SIEM (Splunk).</p> <p><span style="color: royalblue; font-weight: bold;">Part 9 - Tsurugi Linux (DFIR) Setup</span></p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
