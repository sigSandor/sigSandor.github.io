<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(2) > li:not(:nth-child(2)) > a, .site-nav > ul:nth-of-type(2) > li > ul > li > a, .site-nav > ul:nth-of-type(2) > li > ul > li > ul > li > a { background-image: none; } .site-nav > ul:not(:nth-of-type(2)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(2) > li:nth-child(2) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(2) > li:nth-child(2) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(2) > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/assets/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Email Authentication: DMARC | Home</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Email Authentication: DMARC" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Email Authentication Methodology" /> <meta property="og:description" content="Email Authentication Methodology" /> <link rel="canonical" href="https://sigsandor.github.io/security/2024-5-26-DMARC/" /> <meta property="og:url" content="https://sigsandor.github.io/security/2024-5-26-DMARC/" /> <meta property="og:site_name" content="Home" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-05-26T00:00:00-04:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Email Authentication: DMARC" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-05-26T00:00:00-04:00","datePublished":"2024-05-26T00:00:00-04:00","description":"Email Authentication Methodology","headline":"Email Authentication: DMARC","mainEntityOfPage":{"@type":"WebPage","@id":"https://sigsandor.github.io/security/2024-5-26-DMARC/"},"url":"https://sigsandor.github.io/security/2024-5-26-DMARC/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Home </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/CHANGELOG.html" class="nav-list-link">Changelog</a></li></ul> <div class="nav-category">Security</div> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Network & Security Home Lab category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/security/2024-05-15-homelabpart1/" class="nav-list-link">Network & Security Home Lab</a><ul class="nav-list"><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart2/" class="nav-list-link">Part 2 - pfSense Setup & Configuration</a></li><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart3/" class="nav-list-link">Part 3 - Parrot Security (Linux setup)</a></li><li class="nav-list-item"><a href="/security/2024-05-16-homelabpart4/" class="nav-list-link">Part 4 - pfSense Firewall configuration</a></li><li class="nav-list-item"><a href="/security/2024-07-04-homelabpart5/" class="nav-list-link">Part 5 - Cyber Range setup</a></li><li class="nav-list-item"><a href="/security/2024-07-15-homelabpart6/" class="nav-list-link">Part 6 - Active Directory Setup</a></li></ul></li><li class="nav-list-item"><a href="/security/2024-5-26-DMARC/" class="nav-list-link">Email Authentication: DMARC</a></li><li class="nav-list-item"><a href="/security/2024-06-18-KQLbasics/" class="nav-list-link">KQL basics</a></li><li class="nav-list-item"><a href="/security/2022-05-19-links/" class="nav-list-link">Useful Cybersecurity links</a></li></ul> <div class="nav-category">Networking</div> <ul class="nav-list"><li class="nav-list-item"><a href="/networking/2024-06-22-NetworkingProtocols/" class="nav-list-link">Networking 101</a></li></ul> <div class="nav-category">Personal</div> <ul class="nav-list"><li class="nav-list-item"><a href="/personal/2020-05-21-dusunre/" class="nav-list-link">Online History</a></li><li class="nav-list-item"><a href="/personal/2024-05-16-explorepics/" class="nav-list-link">Photo collection</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Home" aria-label="Search Home" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://www.linkedin.com/in/alex-barkman-b7b26a186/" class="site-button" > Linkedin </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/sigSandor" class="site-button" > Github </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 class="text-center" id="email-authentication-methodology"> <a href="#email-authentication-methodology" class="anchor-heading" aria-labelledby="email-authentication-methodology"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Email Authentication Methodology </h1> <p><img src="/assets/dmarc1.jpg" alt="dmarc1" width="auto" height="auto" /></p> <h2 class="text-center" id="dmarc-also-spf-and-dkim-"> <a href="#dmarc-also-spf-and-dkim-" class="anchor-heading" aria-labelledby="dmarc-also-spf-and-dkim-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: orange; font-weight: bold;">DMARC (Also SPF and DKIM) </span> </h2> <h6 id="posted-june-22-2024"> <a href="#posted-june-22-2024" class="anchor-heading" aria-labelledby="posted-june-22-2024"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Posted <strong><em>June 22, 2024</em></strong> </h6> <p class="warning"><code class="language-plaintext highlighter-rouge">DMARC</code> (Domain-based Message Authentication, Reporting &amp; Conformance) is an email authentication protocol that works in tandem with the <code class="language-plaintext highlighter-rouge">SPF</code> and <code class="language-plaintext highlighter-rouge">DKIM</code> protocols.</p> <ul> <li>All 3 protocols are a type of a DNS record, and below we will be exploring the differences that help seperate and validate each protocol.</li> </ul> <p><img src="/assets/emailauth.png" alt="emailauth" width="auto" height="auto" /></p><hr /> <h2 class="text-center" id="dmarc"> <a href="#dmarc" class="anchor-heading" aria-labelledby="dmarc"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bolder;">DMARC</span> </h2> <p>The following examples show syntax that may show up in MX records or email headers.</p> <div class="table-wrapper"><table> <tbody> <tr> <td>Example</td> <td><span style="color: green; font-weight: bold;">v=DMARC1;</span> <span style="color: yellow; font-weight: bold;">p=reject; </span> <span style="color: red; font-weight: bold;">adkim=s; </span> <span style="color: orange; font-weight: bold;"> aspf=s;</span> <span style="color: lightblue; font-weight: bold;">rua=mailto:example@third-party-example.com;</span></td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <tbody> <tr> <td>Example</td> <td>v=DMARC1; p=none; rua=mailto:dmarc-aggregate@mydomain.com; ruf=mailto:dmarc-afrf@mydomain.com; pct=100</td> </tr> </tbody> </table></div> <ul> <li><span style="color: green; font-weight: bold;">v=DMARC1;</span> Specifies the version of DMARC being used.</li> <li> <p><span style="color: yellow; font-weight: bold;">p=reject; </span> Designates the rejection policy. In this case if an Email fails DMARC authentication, it will be outright rejected. ( also see other <a href="https://mxtoolbox.com/dmarc/details/dmarc-tags/dmarc-policy-options">Policy Tag Values</a> )</p> </li> <li> <p><span style="color: red; font-weight: bold;">adkim=s; </span> <span style="color: orange; font-weight: bold;"> aspf=s;</span> Both adkim and aspf, specify the alignment mode for SPF and DKIM, which can be set to “s” or “r” for strict and relaxed modes respectively. ( also see <a href="https://powerdmarc.com/dmarc-alignment/">powerDMARC Aligment modes</a>) <span style="color: royalblue; font-weight: bold;">(a=alignment )</span></p> </li> <li><span style="color: lightblue; font-weight: bold;">rua=mailto:example@third-party-example.com;</span> The Mail To address is where the aggregated reports for DMARC activity will be sent. I.E validation results, failure or pass.</li> </ul><hr /> <h2 id="what-are-some-roadblocks-that-dmarc-and-email-authentication-in-general-have-to-overcome"> <a href="#what-are-some-roadblocks-that-dmarc-and-email-authentication-in-general-have-to-overcome" class="anchor-heading" aria-labelledby="what-are-some-roadblocks-that-dmarc-and-email-authentication-in-general-have-to-overcome"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bold;">What are some roadblocks that DMARC and email authentication in general, have to overcome?</span> </h2> <ul> <li>Not being a high priority for companies.</li> <li>Complex mail enviroments with 3rd party vendors, contractors, and service providers. (Some necessary communication between companies forces companies to allow email communication without this authentication)</li> <li>The latter results in a hearty mix of incoming messages, which can fail to meet business needs and standards.</li> <li>Factors such as the reciever’s configuration vs the senders configuration. (Not enough validations between senders and recievers.)</li> </ul><hr /> <h2 class="text-center" id="spf"> <a href="#spf" class="anchor-heading" aria-labelledby="spf"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bolder;">SPF</span> </h2> <p class="warning"><code class="language-plaintext highlighter-rouge">SPF</code> (Sender Policy Framework) is another email protocol that allows the owner of a domain to publish a record. This record allows sub domains to send email on the behalf of the publisher.</p> <p>When an email is recieved, the record is then cross checked (by the recipient) to check the <code class="language-plaintext highlighter-rouge">SPF</code> alignment.</p> <div class="table-wrapper"><table> <tbody> <tr> <td>Ex 1</td> <td><span style="color: green; font-weight: bold;">myemailserv.com.</span> <span style="color: yellow; font-weight: bold;"></span> <span style="color: red; font-weight: bold;">“v=spf1 include:_spf.google.com include:sendgrid.net ip4:192.0.2.0/24 -all”</span></td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <tbody> <tr> <td>Ex 2</td> <td>myemailserv.com. “v=spf1 ip4:172.10.200.4 ip6:2001:df7:0:2345:0:345:8:1 include:_spf.google.com include:mailgun.org include:amazonses.com -all”</td> </tr> <tr> <td>Ex 3</td> <td>myemailserv.com. “v=spf1 mx a include:_spf.mail.yahoo.com ~all”</td> </tr> </tbody> </table></div> <ul> <li><span style="color: green; font-weight: bold;">myemailserv.com.</span> Specifies the Domain.</li> <li> <p><span style="color: red; font-weight: bold;">“v=spf1 include:_spf.google.com include:sendgrid.net ip4:192.0.2.0/24 -all”</span></p> </li> <li><strong><em>v=spf1</em></strong> specifies the SPF <span style="color: red; font-weight: bold;">version</span> used.</li> <li><strong><em>include:_spf.~.com</em></strong> indicates that an organization’s servers and subdomains are <span style="color: red; font-weight: bold;">authorized</span> to send emails on behalf of rule since it authorizes and <em>includes</em> that specific domain. (google -&gt; gmail or amazon -&gt; amazonses)</li> <li><strong><em>-all</em></strong> specifies that any emails from mail servers not explicitly listed should be rejected and not recieved. (Fail)</li> <li>An <strong><em>~all</em></strong> tag would specify that any emails from a server or IP address, that is not listed in the SPF record <em>will</em> be accepted, although marked.</li> </ul> <p>(also see <a href="https://easydmarc.com/blog/spf-authentication-spf-all-vs-all/">EasyDMARC</a> for more detail and other types of fail policies.)</p><hr /> <h2 class="text-center" id="dkim"> <a href="#dkim" class="anchor-heading" aria-labelledby="dkim"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <span style="color: royalblue; font-weight: bolder;">DKIM</span> </h2> <p class="warning"><code class="language-plaintext highlighter-rouge">DKIM</code> (DomainKeys Identified Mail):is implemented by using public key on sent mail to validate with a senders private key in an association with the DNS record. Essentially it is a signature generated for each email sent outbound that validates the domain an email is claiming to be sent from.</p> <p>Example DKIM Header:</p> <blockquote> <blockquote> <blockquote> <p><span style="color: green; font-weight: bold;">v=1;</span> <span style="color: blue; font-weight: bold;">a=rsa-sha256;</span> <span style="color: yellow; font-weight: bold;">d=example.com;</span> <span style="color: red; font-weight: bold;">s=big-email;</span> <span style="color: purple; font-weight: bold;">h=from:to:subject;</span> <span style="color: orange; font-weight: bold;">bh=uMixy0BsCqhbru4fqPZQdeZY5Pq865sNAnOAxNgUS0s=;</span> <span style="color: lightblue; font-weight: bold;">b=LiIvJeRyqMo0gngiCygwpiKphJjYezb5kXBKCNj8DqRVcCk7obK6OUg4o+EufEbBtRYQfQhgIkx5m70IqA6dP+DBZUcsJyS9C+vm2xRK7qyHi2hUFpYS5pkeiNVoQk/Wk4wZG4tu/g+OA49mS7VX+64FXr79MPwOMRRmJ3lNwJU= </span></p> </blockquote> </blockquote> </blockquote> <p><span style="color: green; font-weight: bold;">v=1;</span> shows which version of DKIM is in use.</p> <p><span style="color: blue; font-weight: bold;">a=rsa-sha256;</span> is the option for analgorithm used to compute the digital signature, or b, as well as generate the hash of the email body, or bh. In this example, RSA-SHA-256 is in use (RSA using SHA-256 as the hash function for the digital signature, and SHA-256 for the body hash).</p> <p><span style="color: yellow; font-weight: bold;">d=example.com;</span> is the domain name of the sender.</p> <p><span style="color: red; font-weight: bold;">s=big-email;</span>is the selector that the receiving server should use to look up the DNS record.</p> <p><span style="color: purple; font-weight: bold;">h=from:to:subject;</span> lists the header fields that are used to create the digital signature, or b. In this case, the from, to, and subject headers are used. If Bob sent an email to Alice using the example.com domain and the subject line was “Recipe for cheesecake,” the content used here would be “bob@example.com” + “alice@example.com” + “Recipe for cheesecake”. (This content would also be canonicalized — put into a standardized format.)</p> <p><span style="color: orange; font-weight: bold;">bh=uMixy0BsCqhbru4fqPZQdeZY5Pq865sNAnOAxNgUS0s=;</span> is the hash of the email body. A hash is the result of a specialized mathematical function called a hash function. This is included so that the receiving email server can compute the signature before the entire email body loads, since email bodies can be any length and loading it may take a long time in some cases.</p> <p><span style="color: lightblue; font-weight: bold;">b=xxxxxxxx</span> is the digital signature, generated from h and bh and signed with the private key.</p> <p>(for more information see: <a href="https://www.cloudflare.com/learning/dns/dns-records/dns-dkim-record/">DKIM Headers</a>)</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
